
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Julia learning notes &#8212; notes</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/vollkorn.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/_static/styles.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Advent of Code notes" href="advent-notes/README.html" />
    <link rel="prev" title="Julia Notes" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">notes</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../titlepage.html">
   notes
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Systems
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../nix-systems/index.html">
   *nix Systems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../nix-systems/nix-installations.html">
     Software installation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nix-systems/nix-sysadmin.html">
     System administration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nix-systems/nix-filesystem.html">
     Disk and filesystem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nix-systems/nix-networks.html">
     Networks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nix-systems/nix-hardware.html">
     Hardware
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nix-systems/boot-bios.html">
     Boot Loaders and BIOS control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nix-systems/systemd.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       systemd
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       journald
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nix-systems/kernel.html">
     Linux Kernel Modules
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../bash/index.html">
   Bash scripting
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../bash/bash-reference.html">
     Bash reference
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../bash/bash-cookbook.html">
     Bash cookbook
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../osx-reference.html">
   OSX Reference
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Programming Languages
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../cpp/index.html">
   C++ and C
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../cpp/declarations.html">
     Declarations in C++
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cpp/conan.html">
     Conan package manager
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cpp/unit-testing.html">
     Unit testing with Catch2! and Trompeloeil
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cpp/swig-cmake.html">
     Using SWIG with CMake
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cpp/cmake.html">
     CMake notes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cpp/member-functions.html">
     On using
     <code class="docutils literal notranslate">
      <span class="pre">
       std::function
      </span>
     </code>
     for member functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Julia Notes
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Julia learning notes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="advent-notes/README.html">
     Advent of Code notes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="advent-notes/scopes.html">
     Julia Scopes
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../python/index.html">
   Python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/py-recipes.html">
     Python recipes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/jupyter-ipython.html">
     Jupyter and iPython cheat sheet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/regex.html">
     Regex in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/py-serial.html">
     Serial communication with Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/high-perf.html">
     High performance Python techniques and paradigms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/c-wrapping.html">
     Wrapping C and C++ into Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/pypi-distribution.html">
     Making a project available on pypi
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/cpp-c-swig.html">
     Wrapping C/C++ code using SWIG
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/requests.html">
     Python
     <code class="docutils literal notranslate">
      <span class="pre">
       requests
      </span>
     </code>
     cookbook
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/flask/using-flask.html">
     Using Python Flask
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/flask/rethink-db-with-flask.html">
     Using RethinkDB with Flask
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/flask/jinja-templating.html">
     Templating HTML pages with jinja
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/fast-api/using-fast-api.html">
     Using FastAPI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/mkdocs-notes.html">
     Notes on mkdocs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/scrapy.html">
     Scrapy
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../js/index.html">
   JavaScript
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../js/jest-testing.html">
     Using Jest testing framework
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../js/js-reference.html">
     JavaScript language reference
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../js/swig-nodejs.html">
     Using SWIG with NodeJS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../js/request-parsing.html">
     Making HTTP requests and parsing in JS and node.js
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../js/extensions/native-messaging.html">
     Native Messaging for Browser Extensions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../js/vue/over-vue.html">
     Vue Overview
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../tex/index.html">
   LaTeX
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tex/latex-documents.html">
     Writing LaTeX documents
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tex/latexmk.html">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       latexmk
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tex/presentations.html">
     Making presentations in LaTeX
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tex/posters.html">
     Creating posters in LaTeX
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  DevOps
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../docker/index.html">
   Docker
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../docker/minio-registry.html">
     Creating a persistent local registry with S3/MinIO
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../docker/docker-cheatsheet.html">
     Docker cheatsheet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../docker/systemd-with-docker.html">
     Using Docker as
     <code class="docutils literal notranslate">
      <span class="pre">
       systemd
      </span>
     </code>
     services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../docker/docker-compose.html">
     The magical world of Docker-Compose
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../docker/dockerfile-recipes.html">
     Dockerfile cookbook
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../docker/docker-swarm.html">
     Docker Swarm
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../aws/index.html">
   Amazon Web Services
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../aws/vpc-overview.html">
     VPC overview
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../aws/setting-up.html">
     AWS Settup
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../aws/ec2-with-docker.html">
     EC2 with Docker
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../aws/goofys-s3.html">
     Using Goofys with S3
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../vms/index.html">
   Virtual Machines
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../vms/sun-virtual-box.html">
     Oracle Virtual Box
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../vms/kvm.html">
     Kernel-based Virtual Machine
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../vms/qemu.html">
     QEMU
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../databases/index.html">
   Databases
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../databases/node-red.html">
     NodeRed Notes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../databases/mongo-db.html">
     Using MongoDB
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../databases/rethink-db.html">
     RethinkDB
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../databases/lang-drivers/py-mongo.html">
     Using MongoDB and Python
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Configurations
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../configurations/shell-rc-profiles.html">
   Shell
   <code class="docutils literal notranslate">
    <span class="pre">
     .*rc
    </span>
   </code>
   and
   <code class="docutils literal notranslate">
    <span class="pre">
     .*profile
    </span>
   </code>
   configurations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../configurations/jupyter-notebook.html">
   Jupyter notebook
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Machine Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/index.html">
   Machine Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../machine-learning/tf-install.html">
   Installing TensorFlow 2.0
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Raspi &amp; Arduino
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../raspi/index.html">
   Raspberry Pi
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../raspi/raspi-config.html">
     Configuring a Raspberry Pi from fresh install
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../raspi/raspi-bit-torrent.html">
     Setting up a Raspberry-Pi for secure bit torrenting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../raspi/pyaudio.html">
     Installing PyAudio on Raspberry Pi
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../arduino/index.html">
   Arduino
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../arduino/platformio.html">
     PlatformIO notes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../arduino/ca-certs-nano.html">
     Copying (root) CA certificates onto Arduino devices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../arduino/arduino-cookbook.html">
     Arduino cookbook
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../arduino/crypto-auth.html">
     Using the ECC0X08 with Arduino devices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mq-mqtt/mqtt-specs.html">
     MQTT Specifications
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mq-mqtt/nginx-load-balancing.html">
     Using NGiNX with Docker
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tools
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../vim/index.html">
   VIM
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../vim/recipes.html">
     Vim Recipes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../vim/vundle.html">
     Vundle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../vim/batch-rename.html">
     Batch renaming in Vim
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../discord/index.html">
   Discord
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../discord/making-bots-python.html">
     Making Discord bots in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../discord/discord-music-hook.html">
     Creating a Discord music feed using webhooks
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../git/index.html">
   Git and VCs
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../git/git-reference.html">
     Git Reference
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../git/gitea-mariadb.html">
     Using Gitea with MariaDB
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../vscode/index.html">
   VSCode
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../vscode/publishing.html">
     Publishing a VSCode extension
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Miscellaneous
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../recommended-talks.html">
   Recommended talks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../software-design-principles.html">
   Software Design Principles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ffmpeg-cheatsheet.html">
   FFMPEG Cheatsheet
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../iptables-and-firewalls.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     iptables
    </span>
   </code>
   and firewall configuration reference.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ci-cd/jenkins-recipes.html">
   Jenkins Cookbook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../security/openssl-cookbook.html">
   OpenSSL Cookbook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualisation/blender-learning.html">
   Learning Blender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../java/gradle-cookbook.html">
   Gradle build-tool cookbook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../automation/mycroft-osx.html">
   Using Mycroft Docker images on OSX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../nix-systems/clamav.html">
   Clam Anti-Virus
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/julia/julia-intro.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/fjebaker/notes"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/fjebaker/notes/issues/new?title=Issue%20on%20page%20%2Fjulia/julia-intro.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/fjebaker/notes/edit/master/julia/julia-intro.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of Contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#types-and-dispatch">
   Types and Dispatch
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#functions-and-dispatch">
   Functions and Dispatch
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#parametric-types">
     Parametric types
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#union-types-and-the-where-keyword">
     Union types and the
     <code class="docutils literal notranslate">
      <span class="pre">
       where
      </span>
     </code>
     keyword
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#posterity-variadics">
     Posterity: variadics
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#custom-types">
   Custom Types
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-a-data-type">
     Defining a data type
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#abstract-interfaces">
     Abstract Interfaces
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#benchmarking">
   Benchmarking
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#specializations-and-speed">
   Specializations and speed
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#julia-compile-to-run-graph">
     Julia compile-to-run graph
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#specialization-and-code-inspection">
     Specialization and code inspection
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#estimating-the-performance-gain-of-specialization">
     Estimating the performance gain of specialization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-run-time-effectively">
     Using Run-time effectively
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generic-programming">
   Generic programming
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generic-programming-with-multiple-dispatch-and-jit">
     Generic Programming with Multiple Dispatch and JIT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-differentialequations-jl">
     Example: DifferentialEquations.jl
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gotchas-and-how-to-handle-them">
   <em>
    Gotchas
   </em>
   and how to handle them
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gotcha-1-global-scope">
     Gotcha 1: Global scope
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-1-wrap-code-in-functions">
       Solution 1: Wrap code in functions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-2-declare-globals-as-compile-time-constants">
       Solution 2: Declare globals as (compile-time) constants
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gotcha-2-type-instabilities">
     Gotcha 2: Type-instabilities
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-1-avoid-type-changes">
       Solution 1: Avoid type changes
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-2-detect-issues-with-code-warntype-or-trace">
       Solution 2: Detect issues with
       <code class="docutils literal notranslate">
        <span class="pre">
         @code_warntype
        </span>
       </code>
       or
       <code class="docutils literal notranslate">
        <span class="pre">
         @trace
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-3-c-fortran-type-specifications">
       Solution 3: C/Fortran type specifications
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-4-function-barriers">
       Solution 4: Function barriers
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gotcha-3-views-and-copies">
     Gotcha 3: Views and copies
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examples">
   Examples
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gotcha-4-temporary-allocations-and-vectorized-code">
     Gotcha 4: Temporary allocations and vectorized code
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-more-dots-and-explicit-code">
       Solution: More dots and explicit code
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gotcha-5-abstract-fields">
     Gotcha 5: Abstract fields
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gotcha-6-writing-to-global-scope">
     Gotcha 6: Writing to global scope
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gotcha-7-column-major-order">
     Gotcha 7: Column major order
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#nb-put-the-fastest-varying-index-first">
       <strong>
        NB
       </strong>
       : put the fastest varying index first!
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gotcha-8-lazy-operations">
     Gotcha 8: Lazy operations
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   Examples
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extra-generators-and-comprehension">
     Extra: Generators and comprehension.
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Julia learning notes</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of Contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#types-and-dispatch">
   Types and Dispatch
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#functions-and-dispatch">
   Functions and Dispatch
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#parametric-types">
     Parametric types
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#union-types-and-the-where-keyword">
     Union types and the
     <code class="docutils literal notranslate">
      <span class="pre">
       where
      </span>
     </code>
     keyword
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#posterity-variadics">
     Posterity: variadics
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#custom-types">
   Custom Types
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-a-data-type">
     Defining a data type
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#abstract-interfaces">
     Abstract Interfaces
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#benchmarking">
   Benchmarking
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#specializations-and-speed">
   Specializations and speed
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#julia-compile-to-run-graph">
     Julia compile-to-run graph
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#specialization-and-code-inspection">
     Specialization and code inspection
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#estimating-the-performance-gain-of-specialization">
     Estimating the performance gain of specialization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-run-time-effectively">
     Using Run-time effectively
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generic-programming">
   Generic programming
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generic-programming-with-multiple-dispatch-and-jit">
     Generic Programming with Multiple Dispatch and JIT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-differentialequations-jl">
     Example: DifferentialEquations.jl
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gotchas-and-how-to-handle-them">
   <em>
    Gotchas
   </em>
   and how to handle them
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gotcha-1-global-scope">
     Gotcha 1: Global scope
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-1-wrap-code-in-functions">
       Solution 1: Wrap code in functions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-2-declare-globals-as-compile-time-constants">
       Solution 2: Declare globals as (compile-time) constants
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gotcha-2-type-instabilities">
     Gotcha 2: Type-instabilities
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-1-avoid-type-changes">
       Solution 1: Avoid type changes
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-2-detect-issues-with-code-warntype-or-trace">
       Solution 2: Detect issues with
       <code class="docutils literal notranslate">
        <span class="pre">
         @code_warntype
        </span>
       </code>
       or
       <code class="docutils literal notranslate">
        <span class="pre">
         @trace
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-3-c-fortran-type-specifications">
       Solution 3: C/Fortran type specifications
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-4-function-barriers">
       Solution 4: Function barriers
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gotcha-3-views-and-copies">
     Gotcha 3: Views and copies
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examples">
   Examples
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gotcha-4-temporary-allocations-and-vectorized-code">
     Gotcha 4: Temporary allocations and vectorized code
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-more-dots-and-explicit-code">
       Solution: More dots and explicit code
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gotcha-5-abstract-fields">
     Gotcha 5: Abstract fields
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gotcha-6-writing-to-global-scope">
     Gotcha 6: Writing to global scope
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gotcha-7-column-major-order">
     Gotcha 7: Column major order
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#nb-put-the-fastest-varying-index-first">
       <strong>
        NB
       </strong>
       : put the fastest varying index first!
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gotcha-8-lazy-operations">
     Gotcha 8: Lazy operations
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   Examples
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extra-generators-and-comprehension">
     Extra: Generators and comprehension.
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="julia-learning-notes">
<h1>Julia learning notes<a class="headerlink" href="#julia-learning-notes" title="Permalink to this headline">¶</a></h1>
<p>Some notes from my first day of learning the Julia language; converted from an iPython notebook I wrote based heavily on work by <a class="reference external" href="https://github.com/crstnbr/JuliaOulu20">crstnbr</a>.</p>
<!--BEGIN TOC-->
<div class="section" id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><a class="reference external" href="#types-and-dispatch">Types and Dispatch</a></p></li>
<li><p><a class="reference external" href="#functions-and-dispatch">Functions and Dispatch</a></p>
<ol class="simple">
<li><p><a class="reference external" href="#parametric-types">Parametric types</a></p></li>
<li><p><a class="reference external" href="#union-types-and-the-where-keyword">Union types and the <code class="docutils literal notranslate"><span class="pre">where</span></code> keyword</a></p></li>
<li><p><a class="reference external" href="#posterity-variadics">Posterity: variadics</a></p></li>
</ol>
</li>
<li><p><a class="reference external" href="#custom-types">Custom Types</a></p>
<ol class="simple">
<li><p><a class="reference external" href="#defining-a-data-type">Defining a data type</a></p></li>
<li><p><a class="reference external" href="#abstract-interfaces">Abstract Interfaces</a></p></li>
</ol>
</li>
<li><p><a class="reference external" href="#benchmarking">Benchmarking</a></p></li>
<li><p><a class="reference external" href="#specializations-and-speed">Specializations and speed</a></p>
<ol class="simple">
<li><p><a class="reference external" href="#julia-compile-to-run-graph">Julia compile-to-run graph</a></p></li>
<li><p><a class="reference external" href="#specialization-and-code-inspection">Specialization and code inspection</a></p></li>
<li><p><a class="reference external" href="#estimating-the-performance-gain-of-specialization">Estimating the performance gain of specialization</a></p></li>
<li><p><a class="reference external" href="#using-run-time-effectively">Using Run-time effectively</a></p></li>
</ol>
</li>
<li><p><a class="reference external" href="#generic-programming">Generic programming</a></p>
<ol class="simple">
<li><p><a class="reference external" href="#generic-programming-with-multiple-dispatch-and-jit">Generic Programming with Multiple Dispatch and JIT</a></p></li>
<li><p><a class="reference external" href="#example-differentialequations-jl">Example: DifferentialEquations.jl</a></p></li>
</ol>
</li>
<li><p><a class="reference external" href="#*gotchas*-and-how-to-handle-them"><em>Gotchas</em> and how to handle them</a></p>
<ol class="simple">
<li><p><a class="reference external" href="#gotcha-1-global-scope">Gotcha 1: Global scope</a></p>
<ol class="simple">
<li><p><a class="reference external" href="#solution-1-wrap-code-in-functions">Solution 1: Wrap code in functions</a></p></li>
<li><p><a class="reference external" href="#solution-2-declare-globals-as-compile-time-constants">Solution 2: Declare globals as (compile-time) constants</a></p></li>
</ol>
</li>
<li><p><a class="reference external" href="#gotcha-2-type-instabilities">Gotcha 2: Type-instabilities</a></p>
<ol class="simple">
<li><p><a class="reference external" href="#solution-1-avoid-type-changes">Solution 1: Avoid type changes</a></p></li>
<li><p><a class="reference external" href="#solution-2-detect-issues-with-&#64;code_warntype-or-&#64;trace">Solution 2: Detect issues with <code class="docutils literal notranslate"><span class="pre">&#64;code_warntype</span></code> or <code class="docutils literal notranslate"><span class="pre">&#64;trace</span></code></a></p></li>
<li><p><a class="reference external" href="#solution-3-c/fortran-type-specifications">Solution 3: C/Fortran type specifications</a></p></li>
<li><p><a class="reference external" href="#solution-4-function-barriers">Solution 4: Function barriers</a></p></li>
</ol>
</li>
<li><p><a class="reference external" href="#gotcha-3-views-and-copies">Gotcha 3: Views and copies</a></p></li>
</ol>
</li>
<li><p><a class="reference external" href="#examples">Examples</a></p>
<ol class="simple">
<li><p><a class="reference external" href="#gotcha-4-temporary-allocations-and-vectorized-code">Gotcha 4: Temporary allocations and vectorized code</a></p>
<ol class="simple">
<li><p><a class="reference external" href="#solution-more-dots-and-explicit-code">Solution: More dots and explicit code</a></p></li>
</ol>
</li>
<li><p><a class="reference external" href="#gotcha-5-abstract-fields">Gotcha 5: Abstract fields</a></p></li>
<li><p><a class="reference external" href="#gotcha-6-writing-to-global-scope">Gotcha 6: Writing to global scope</a></p></li>
<li><p><a class="reference external" href="#gotcha-7-column-major-order">Gotcha 7: Column major order</a></p>
<ol class="simple">
<li><p><a class="reference external" href="#**nb**-put-the-fastest-varying-index-first%21"><strong>NB</strong>: put the fastest varying index first!</a></p></li>
</ol>
</li>
<li><p><a class="reference external" href="#gotcha-8-lazy-operations">Gotcha 8: Lazy operations</a></p></li>
</ol>
</li>
<li><p><a class="reference external" href="#examples">Examples</a></p>
<ol class="simple">
<li><p><a class="reference external" href="#extra-generators-and-comprehension-">Extra: Generators and comprehension.</a></p></li>
</ol>
</li>
</ol>
<!--END TOC-->
</div>
<div class="section" id="types-and-dispatch">
<h2>Types and Dispatch<a class="headerlink" href="#types-and-dispatch" title="Permalink to this headline">¶</a></h2>
<p>Julia has notions of <strong>concrete</strong> and <strong>abstract</strong> types; i.e. those of objects, and those that cannot be instantiated but instead define a structure.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@show</span><span class="w"> </span><span class="n">typeof</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="n">typeof</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="w"> </span><span class="n">isconcretetype</span><span class="p">(</span><span class="kt">Float64</span><span class="p">)</span><span class="w"> </span><span class="n">isabstracttype</span><span class="p">(</span><span class="kt">Number</span><span class="p">)</span><span class="w"> </span><span class="n">isabstracttype</span><span class="p">(</span><span class="kt">Real</span><span class="p">)</span><span class="w"></span>

<span class="n">println</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Investigating the type tree:&quot;</span><span class="p">)</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="n">supertype</span><span class="p">(</span><span class="kt">Float64</span><span class="p">)</span><span class="w"> </span><span class="n">subtypes</span><span class="p">(</span><span class="kt">AbstractFloat</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>typeof(3) = Int64
typeof(3.0) = Float64
isconcretetype(Float64) = true
isabstracttype(Number) = true
isabstracttype(Real) = true

Investigating the type tree:
supertype(Float64) = AbstractFloat
subtypes(AbstractFloat) = Any[BigFloat, Float16, Float32, Float64]
</pre></div>
</div>
<p>Everything is a subtype of <code class="docutils literal notranslate"><span class="pre">Any</span></code>, just as in Python with <code class="docutils literal notranslate"><span class="pre">Object</span></code>. We can investigate this for <code class="docutils literal notranslate"><span class="pre">Type</span></code> with the <code class="docutils literal notranslate"><span class="pre">&lt;:</span></code> operator, and for objects, with the <code class="docutils literal notranslate"><span class="pre">isa</span></code> keyword:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@show</span><span class="w"> </span><span class="kt">Number</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">Any</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="mf">3.0</span><span class="w"> </span><span class="k">isa</span><span class="w"> </span><span class="kt">Float64</span><span class="w"> </span><span class="mf">3.0</span><span class="w"> </span><span class="k">isa</span><span class="w"> </span><span class="kt">Int32</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Number &lt;: Any = true
3.0 isa Float64 = true
3.0 isa Int32 = false
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">show_supertypes</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;&quot;&quot; function for investigating type tree from leaf T to root Any &quot;&quot;&quot;</span><span class="w"></span>
<span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kt">Any</span><span class="w"></span>
<span class="w">        </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supertype</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">print</span><span class="p">(</span><span class="s">&quot; &lt;: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="n">show_supertypes</span><span class="p">(</span><span class="kt">Float64</span><span class="p">)</span><span class="w"></span>
<span class="n">show_supertypes</span><span class="p">(</span><span class="kt">String</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Float64 &lt;: AbstractFloat
 &lt;: Real
 &lt;: Number
 &lt;: Any
String &lt;: AbstractString
 &lt;: Any
</pre></div>
</div>
<p>Tool for facilitating creating easy print trees is <code class="docutils literal notranslate"><span class="pre">AbstractTrees</span></code>, which we can define a method for to tailor our case to print subtypes.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="n">Pkg</span><span class="p">;</span><span class="w"> </span><span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;AbstractTrees&quot;</span><span class="p">);</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="n">AbstractTrees</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[32m[1m   Updating[22m[39m registry at `~/.julia/registries/General`


[?25l[2K

[32m[1m   Updating[22m[39m git-repo `https://github.com/JuliaRegistries/General.git`


[?25h

[32m[1m  Resolving[22m[39m package versions...
[32m[1m   Updating[22m[39m `~/.julia/environments/v1.4/Project.toml`
[90m [no changes][39m
[32m[1m   Updating[22m[39m `~/.julia/environments/v1.4/Manifest.toml`
[90m [no changes][39m
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">AbstractTrees</span><span class="o">.</span><span class="n">children</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Type</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subtypes</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="n">print_tree</span><span class="p">(</span><span class="kt">Number</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Number
├─ Complex
└─ Real
   ├─ AbstractFloat
   │  ├─ BigFloat
   │  ├─ Float16
   │  ├─ Float32
   │  └─ Float64
   ├─ AbstractIrrational
   │  └─ Irrational
   ├─ Integer
   │  ├─ Bool
   │  ├─ Signed
   │  │  ├─ BigInt
   │  │  ├─ Int128
   │  │  ├─ Int16
   │  │  ├─ Int32
   │  │  ├─ Int64
   │  │  └─ Int8
   │  └─ Unsigned
   │     ├─ UInt128
   │     ├─ UInt16
   │     ├─ UInt32
   │     ├─ UInt64
   │     └─ UInt8
   └─ Rational
</pre></div>
</div>
<p>Note that only <strong>concrete</strong> types are and leaf points, whereas <strong>abstract</strong> types are the nodes.</p>
</div>
<div class="section" id="functions-and-dispatch">
<h2>Functions and Dispatch<a class="headerlink" href="#functions-and-dispatch" title="Permalink to this headline">¶</a></h2>
<p>Example: a function that calculates absolute values (like builtin <code class="docutils literal notranslate"><span class="pre">abs</span></code> already does).
Want something to work for Reals and Complex; thus want to create type specific implementations of the function:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">myabs</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Real</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="n">myabs</span><span class="p">(</span><span class="n">z</span><span class="o">::</span><span class="kt">Complex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">real</span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">conj</span><span class="p">(</span><span class="n">z</span><span class="p">)))</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="n">myabs</span><span class="p">(</span><span class="o">-</span><span class="mf">4.32</span><span class="p">)</span><span class="w"> </span><span class="n">myabs</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="mf">1.0</span><span class="nb">im</span><span class="p">);</span><span class="w"></span>

<span class="n">println</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">methods</span><span class="p">(</span><span class="n">myabs</span><span class="p">))</span><span class="w"></span>
<span class="c"># check which method is being used using the @which macro</span><span class="w"></span>
<span class="n">println</span><span class="p">(</span><span class="nd">@which</span><span class="w"> </span><span class="n">myabs</span><span class="p">(</span><span class="o">-</span><span class="mf">4.32</span><span class="p">))</span><span class="w"></span>
<span class="n">println</span><span class="p">(</span><span class="nd">@which</span><span class="w"> </span><span class="n">myabs</span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.0</span><span class="nb">im</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>myabs(-4.32) = 4.32
myabs(1.0 + 1.0im) = 1.4142135623730951

# 2 methods for generic function &quot;myabs&quot;:
[1] myabs(x::Real) in Main at In[6]:1
[2] myabs(z::Complex) in Main at In[6]:2
myabs(x::Real) in Main at In[6]:1
myabs(z::Complex) in Main at In[6]:2
</pre></div>
</div>
<p>Multiple dispatch in Julia optimises to pick the most <strong>specific method</strong> for given input parameter types. We can also modify the standard functions for our flavour or needs:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="n">Base</span><span class="o">:</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c"># have to import functions to be able to override/extend them</span><span class="w"></span>
<span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">::</span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"></span>

<span class="c"># now, any use of +, even in functions, uses our method</span><span class="w"></span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;World&quot;</span><span class="p">)</span><span class="w"></span>
<span class="n">println</span><span class="p">(</span><span class="n">sum</span><span class="p">([</span><span class="s">&quot;Hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;World&quot;</span><span class="p">]));</span><span class="w"></span>

<span class="c"># no unique most specific method</span><span class="w"></span>
<span class="n">testf</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">::</span><span class="kt">Any</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;int&quot;</span><span class="p">)</span><span class="w"></span>
<span class="n">testf</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Any</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">::</span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;string&quot;</span><span class="p">)</span><span class="w"></span>
<span class="n">testf</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test&quot;</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Hello World
Hello World



MethodError: testf(::Int64, ::String) is ambiguous. Candidates:
  testf(x::Int64, y) in Main at In[7]:9
  testf(x, y::String) in Main at In[7]:10
Possible fix, define
  testf(::Int64, ::String)



Stacktrace:

 [1] top-level scope at In[7]:11
</pre></div>
</div>
<div class="section" id="parametric-types">
<h3>Parametric types<a class="headerlink" href="#parametric-types" title="Permalink to this headline">¶</a></h3>
<p>An example of use of <strong>type parameters</strong> is the Julia array type:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="n">typeof</span><span class="p">(</span><span class="n">M</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>M = [0.9615517851600281 0.2903357436474676; 0.19803186892630564 0.52189913680374]
typeof(M) = Array{Float64,2}
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Array</span></code> is a parametric array, with type <code class="docutils literal notranslate"><span class="pre">Float64</span></code>and dimension <code class="docutils literal notranslate"><span class="pre">2</span></code>. Thus, <code class="docutils literal notranslate"><span class="pre">M</span></code> is a 2x2 matrix. We can also create the same for <code class="docutils literal notranslate"><span class="pre">String</span></code> type arrays, or nest parametric types:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fill</span><span class="p">(</span><span class="s">&quot;Hello World&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="n">typeof</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="n">eltype</span><span class="p">(</span><span class="n">M</span><span class="p">);</span><span class="w"></span>

<span class="c"># using list comprehension to create a vector of matrices of floats</span><span class="w"></span>
<span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">3</span><span class="p">]</span><span class="w"></span>
<span class="n">println</span><span class="p">()</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="n">eltype</span><span class="p">(</span><span class="n">v</span><span class="p">);</span><span class="w"></span>

<span class="c"># Julia has aliases for matrix and vectors</span><span class="w"></span>
<span class="n">println</span><span class="p">()</span><span class="w"></span>
<span class="n">println</span><span class="p">(</span><span class="kt">Matrix</span><span class="p">{</span><span class="kt">Float64</span><span class="p">}</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kt">Array</span><span class="p">{</span><span class="kt">Float64</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">})</span><span class="w"></span>
<span class="n">println</span><span class="p">(</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">Float64</span><span class="p">}</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kt">Array</span><span class="p">{</span><span class="kt">Float64</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">})</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>M = [&quot;Hello World&quot; &quot;Hello World&quot;; &quot;Hello World&quot; &quot;Hello World&quot;]
typeof(M) = Array{String,2}
eltype(M) = String

v = [[0.09276764692539108 0.03911682059083299; 0.3521196560922837 0.3858365720172432], [0.08326363372635615 0.10287492655839703; 0.6998072334761969 0.9958601605012154], [0.21398961354127977 0.432695279314101; 0.17643405797687572 0.391593928329907]]
eltype(v) = Array{Float64,2}

true
true
</pre></div>
</div>
</div>
<div class="section" id="union-types-and-the-where-keyword">
<h3>Union types and the <code class="docutils literal notranslate"><span class="pre">where</span></code> keyword<a class="headerlink" href="#union-types-and-the-where-keyword" title="Permalink to this headline">¶</a></h3>
<p>Note that <code class="docutils literal notranslate"><span class="pre">Vector{Float64}</span> <span class="pre">&lt;:</span> <span class="pre">Vector{Real}</span></code> is <code class="docutils literal notranslate"><span class="pre">false</span></code>, despite <code class="docutils literal notranslate"><span class="pre">Float64</span> <span class="pre">&lt;:</span> <span class="pre">Real</span></code>, and this is exactly since <code class="docutils literal notranslate"><span class="pre">Vector{Real}</span></code> is a concrete type (with elements <code class="docutils literal notranslate"><span class="pre">T</span> <span class="pre">&lt;:</span> <span class="pre">Real</span></code>): <strong>concrete types</strong> don’t have subtypes.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@show</span><span class="w"> </span><span class="kt">Real</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2.2</span><span class="p">,</span><span class="w"> </span><span class="mf">13f0</span><span class="p">]</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="n">isconcretetype</span><span class="p">(</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">Real</span><span class="p">})</span><span class="w"></span>
<span class="c"># what we actually mean is</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="kt">Vector</span><span class="p">{</span><span class="kt">Float64</span><span class="p">}</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">Vector</span><span class="p">{</span><span class="kt">T</span><span class="p">}</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">Real</span><span class="w"></span>
<span class="c"># thus, written explicitly</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="kt">Vector</span><span class="p">{</span><span class="kt">Real</span><span class="p">}</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">Vector</span><span class="p">{</span><span class="kt">T</span><span class="w"> </span><span class="kt">where</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">Real</span><span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Real[1, 2.2, 13.0f0] = Real[1, 2.2, 13.0f0]
isconcretetype(Vector{Real}) = true
Vector{Float64} &lt;: (Vector{T} where T &lt;: Real) = true
Vector{Real} &lt;: Vector{T where T &lt;: Real} = true
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># type parameters as function signatures</span><span class="w"></span>
<span class="n">h</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Integer</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="n">h</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">T</span><span class="p">)</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="w"></span>
<span class="n">h</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Matrix</span><span class="p">{</span><span class="kt">T</span><span class="p">})</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">Real</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;i will be overwritten by the next def&quot;</span><span class="w"></span>
<span class="c"># or</span><span class="w"></span>
<span class="n">h</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Matrix</span><span class="p">{</span><span class="o">&lt;:</span><span class="kt">Real</span><span class="p">})</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eltype</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="kt">Float32</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>

<span class="n">d</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">T</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">::</span><span class="kt">T</span><span class="p">)</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;same type&quot;</span><span class="w"></span>
<span class="n">d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;different types&quot;</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="n">d</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="n">d</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>h(rand(Float32, 2, 2)) = Float32
d(3, 4) = &quot;same type&quot;
d(3.0, 1) = &quot;different types&quot;
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># duck typing example</span><span class="w"></span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">30</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">AbstractArray</span><span class="p">;</span><span class="w"></span>
<span class="n">println</span><span class="p">()</span><span class="w"></span>
<span class="c"># since it is &lt;:AbstractArray, can perform array actions</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">eltype</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="c"># but it isn&#39;t an actual Array, which can be seen by examining the fields</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="n">fieldnames</span><span class="p">(</span><span class="n">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"></span>
<span class="c"># or inspecting source code</span><span class="w"></span>
<span class="nd">@which</span><span class="w"> </span><span class="kt">UnitRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>x = 1:30
typeof(x) = UnitRange{Int64}
typeof(x) &lt;: AbstractArray = true

x[3] = 3
size(x) = (30,)
eltype(x) = Int64
fieldnames(typeof(x)) = (:start, :stop)
</pre></div>
</div>
<p>(::<b>Type{UnitRange}</b>)(start::<b>T</b>, stop::<b>T</b>)<i> where T&lt;:Real</i> in Base at <a href="https://github.com/JuliaLang/julia/tree/381693d3dfc9b7072707f6d544f82f6637fc5e7c/base/range.jl#L279" target="_blank">range.jl:279</a></p>
<p>When performing an indexing, a small function is executed (see with <code class="docutils literal notranslate"><span class="pre">&#64;which</span> <span class="pre">getindex(x,</span> <span class="pre">4)</span></code> for example); can be used in calculations without having to allocate memory for a full array. Memory allocation is expensive:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@time</span><span class="w"> </span><span class="n">collect</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">1000000</span><span class="p">);</span><span class="w"></span>
<span class="nd">@time</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">1000000</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  0.021088 seconds (2 allocations: 7.629 MiB, 81.03% gc time)
  0.000000 seconds
</pre></div>
</div>
<p>Other types include union types <code class="docutils literal notranslate"><span class="pre">Union{Float64,</span> <span class="pre">Int32}</span></code>, <a class="reference external" href="https://docs.julialang.org/en/v1/manual/calling-c-and-fortran-code/#man-bits-types-1">bit based</a> typing and check functions, e.g. <code class="docutils literal notranslate"><span class="pre">isbits(x)</span></code>, <code class="docutils literal notranslate"><span class="pre">isbitstype(T)</span></code></p>
<p>Full refernce for types can be found in <a class="reference external" href="https://docs.julialang.org/en/latest/manual/types/">this page of the manual</a>.</p>
</div>
<div class="section" id="posterity-variadics">
<h3>Posterity: variadics<a class="headerlink" href="#posterity-variadics" title="Permalink to this headline">¶</a></h3>
<p>Julia can use variadic arguments in function signatures or calls:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="o">...</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">println</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Vector</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="o">...</span><span class="p">)</span><span class="w"></span>
<span class="n">g</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(3, 1.2, &quot;Hello&quot;)





6
</pre></div>
</div>
<p>The use of the <code class="docutils literal notranslate"><span class="pre">...</span></code> operator can be a little misleading, but is <a class="reference external" href="https://docs.julialang.org/en/v1/manual/faq/index.html#What-does-the-...-operator-do?-1">well documented</a>.</p>
<p>It can either</p>
<ul class="simple">
<li><p>combine many arguments into one argument, like <code class="docutils literal notranslate"><span class="pre">*args</span></code> in Python. Returns type <code class="docutils literal notranslate"><span class="pre">Tuple</span></code></p></li>
<li><p>split one argument into many different arguments in a function call, like calling a function with <code class="docutils literal notranslate"><span class="pre">f(*some_list)</span></code> in Python.</p></li>
</ul>
</div>
</div>
<div class="section" id="custom-types">
<h2>Custom Types<a class="headerlink" href="#custom-types" title="Permalink to this headline">¶</a></h2>
<div class="section" id="defining-a-data-type">
<h3>Defining a data type<a class="headerlink" href="#defining-a-data-type" title="Permalink to this headline">¶</a></h3>
<p>Types can be defined with the <code class="docutils literal notranslate"><span class="pre">struct</span></code> keyword (<em>NB</em>: they cannot be redefined; would have to restart the Julia kernel). The <code class="docutils literal notranslate"><span class="pre">struct</span></code> objects behave like classes, with different methods (e.g. constructors) defineable. They are by default <strong>immutable</strong>, but note that the immutability does not propagate (<strong>edit</strong>: it totally does?):</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="kt">ImmPropagate</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">Int64</span><span class="p">}</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImmPropagate</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">])</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="n">t</span><span class="o">.</span><span class="n">x</span><span class="w"></span>
<span class="k">try</span><span class="w"> </span><span class="n">t</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="n">println</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">end</span><span class="w"></span>
<span class="n">t</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="n">t</span><span class="o">.</span><span class="n">x</span><span class="w"></span>
<span class="n">t</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">.=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">]</span><span class="w"> </span><span class="c"># dot performs el-wise assignment</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="n">t</span><span class="o">.</span><span class="n">x</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>t.x = [1, 2, 3]
ErrorException(&quot;setfield! immutable struct of type ImmPropagate cannot be changed&quot;)
t.x = [0, 2, 3]
t.x = [3, 8, 12]
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># define abstract types and subtype them easily</span><span class="w"></span>
<span class="k">abstract</span><span class="w"> </span><span class="k">type</span> <span class="kt">SomeAbstractType</span><span class="w"> </span><span class="k">end</span><span class="w"></span>

<span class="k">struct</span> <span class="kt">SomeConcreteType</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">SomeAbstractType</span><span class="w"></span>
<span class="w">    </span><span class="n">somefield</span><span class="o">::</span><span class="kt">String</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="n">supertype</span><span class="p">(</span><span class="n">SomeConcreteType</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SomeAbstractType
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># example: a diagonal matrix structure</span><span class="w"></span>
<span class="k">import</span><span class="w"> </span><span class="n">Base</span><span class="o">:</span><span class="w"> </span><span class="o">+</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="o">/</span><span class="w"></span>

<span class="k">struct</span> <span class="kt">DiagonalMat</span><span class="w"></span>
<span class="w">    </span><span class="n">diag</span><span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">Float64</span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c"># functions declared here are private?</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="o">+</span><span class="p">(</span><span class="n">a</span><span class="o">::</span><span class="kt">DiagonalMat</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">::</span><span class="kt">DiagonalMat</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DiagonalMat</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">diag</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="n">diag</span><span class="p">)</span><span class="w"></span>
<span class="o">-</span><span class="p">(</span><span class="n">a</span><span class="o">::</span><span class="kt">DiagonalMat</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">::</span><span class="kt">DiagonalMat</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DiagonalMat</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">diag</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="n">diag</span><span class="p">)</span><span class="w"></span>

<span class="n">d1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DiagonalMat</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">])</span><span class="w"> </span><span class="c"># implicit conversion to float</span><span class="w"></span>
<span class="n">d2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DiagonalMat</span><span class="p">([</span><span class="mf">2.4</span><span class="p">,</span><span class="w"> </span><span class="mf">1.9</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">])</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="n">d1</span><span class="o">+</span><span class="n">d2</span><span class="w"> </span><span class="n">d1</span><span class="o">-</span><span class="n">d2</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>d1 + d2 = DiagonalMat([3.4, 3.9, 8.0])
d1 - d2 = DiagonalMat([-1.4, 0.10000000000000009, -2.0])





DiagonalMat([-1.4, 0.10000000000000009, -2.0])
</pre></div>
</div>
</div>
<div class="section" id="abstract-interfaces">
<h3>Abstract Interfaces<a class="headerlink" href="#abstract-interfaces" title="Permalink to this headline">¶</a></h3>
<p>Integrating an object into Julia’s type hierarchy is as simple as subtyping an abstract class, and implementing its interface. For example, we could recreate the <code class="docutils literal notranslate"><span class="pre">DiagonalMat</span></code> struct by subtyping <code class="docutils literal notranslate"><span class="pre">AbstractMatrix</span></code>, and the storage with <code class="docutils literal notranslate"><span class="pre">AbstractVector</span></code>:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="kt">DiagonalMatrix</span><span class="p">{</span><span class="kt">T</span><span class="p">,</span><span class="w"> </span><span class="kt">V</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">AbstractVector</span><span class="p">{</span><span class="kt">T</span><span class="p">}}</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">AbstractMatrix</span><span class="p">{</span><span class="kt">T</span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">diag</span><span class="o">::</span><span class="kt">V</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c"># implement AbstractArray interface</span><span class="w"></span>
<span class="n">Base</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">D</span><span class="o">::</span><span class="kt">DiagonalMatrix</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">diag</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">diag</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span>
<span class="k">function</span><span class="w"> </span><span class="n">Base</span><span class="o">.</span><span class="n">getindex</span><span class="p">(</span><span class="n">D</span><span class="o">::</span><span class="kt">DiagonalMatrix</span><span class="p">{</span><span class="kt">T</span><span class="p">,</span><span class="kt">V</span><span class="p">},</span><span class="w"> </span><span class="n">i</span><span class="o">::</span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">::</span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="p">{</span><span class="kt">T</span><span class="p">,</span><span class="w"> </span><span class="kt">V</span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span><span class="w"></span>
<span class="w">        </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="o">.</span><span class="n">diag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="w">        </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="n">r</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c"># different syntactic sugar, same idiom</span><span class="w"></span>
<span class="k">function</span><span class="w"> </span><span class="n">setindex!</span><span class="p">(</span><span class="n">D</span><span class="o">::</span><span class="kt">DiagonalMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">::</span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">::</span><span class="kt">Int</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span><span class="w"></span>
<span class="w">        </span><span class="n">D</span><span class="o">.</span><span class="n">diag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="w">        </span><span class="n">throw</span><span class="p">(</span><span class="kt">ArgumentError</span><span class="p">(</span><span class="s">&quot;cannot set off-diagonal entry (</span><span class="si">$i</span><span class="s">, </span><span class="si">$j</span><span class="s">)&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="w">    </span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>setindex! (generic function with 1 method)
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DiagonalMatrix</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">])</span><span class="w"></span>
<span class="c"># automatically has +, -, *, etc. defined, and pprint</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="n">D</span><span class="o">*</span><span class="n">D</span><span class="w"> </span><span class="n">D</span><span class="o">+</span><span class="n">D</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>D = [1 0 0; 0 2 0; 0 0 3]
D * D = [1 0 0; 0 4 0; 0 0 9]
D + D = [2 0 0; 0 4 0; 0 0 6]





3×3 Array{Int64,2}:
 2  0  0
 0  4  0
 0  0  6
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># even more complicated functions</span><span class="w"></span>
<span class="n">println</span><span class="p">(</span><span class="n">sin</span><span class="o">.</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="w"></span>
<span class="n">println</span><span class="p">(</span><span class="n">sum</span><span class="p">([</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">]))</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="n">LinearAlgebra</span><span class="w"></span>
<span class="n">eigen</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[0.8414709848078965 0.0 0.0; 0.0 0.9092974268256817 0.0; 0.0 0.0 0.1411200080598672]
[3 0 0; 0 6 0; 0 0 9]





Eigen{Float64,Float64,Array{Float64,2},Array{Float64,1}}
values:
3-element Array{Float64,1}:
 1.0
 2.0
 3.0
vectors:
3×3 Array{Float64,2}:
 1.0  0.0  0.0
 0.0  1.0  0.0
 0.0  0.0  1.0
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@which</span><span class="w"> </span><span class="n">D</span><span class="o">+</span><span class="n">D</span><span class="w"></span>
</pre></div>
</div>
<p>+(A::<b>AbstractArray</b>, B::<b>AbstractArray</b>) in Base at <a href="https://github.com/JuliaLang/julia/tree/381693d3dfc9b7072707f6d544f82f6637fc5e7c/base/arraymath.jl#L38" target="_blank">arraymath.jl:38</a></p>
<p>Can be advantageous to define fast implementations</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="p">(</span><span class="n">Da</span><span class="o">::</span><span class="kt">DiagonalMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">Db</span><span class="o">::</span><span class="kt">DiagonalMatrix</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DiagonalMatrix</span><span class="p">(</span><span class="n">Da</span><span class="o">.</span><span class="n">diag</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Db</span><span class="o">.</span><span class="n">diag</span><span class="p">)</span><span class="w"></span>
<span class="o">-</span><span class="p">(</span><span class="n">Da</span><span class="o">::</span><span class="kt">DiagonalMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">Db</span><span class="o">::</span><span class="kt">DiagonalMatrix</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DiagonalMatrix</span><span class="p">(</span><span class="n">Da</span><span class="o">.</span><span class="n">diag</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Db</span><span class="o">.</span><span class="n">diag</span><span class="p">)</span><span class="w"></span>

<span class="nd">@which</span><span class="w"> </span><span class="n">D</span><span class="o">+</span><span class="n">D</span><span class="w"></span>
</pre></div>
</div>
<p>+(Da::<b>DiagonalMatrix</b>, Db::<b>DiagonalMatrix</b>) in Main at In[11]:1</p>
</div>
</div>
<div class="section" id="benchmarking">
<h2>Benchmarking<a class="headerlink" href="#benchmarking" title="Permalink to this headline">¶</a></h2>
<p>Benchmarking in Julia is easily fascilitated with the <a class="reference external" href="https://github.com/JuliaCI/BenchmarkTools.jl/blob/master/doc/manual.md"><code class="docutils literal notranslate"><span class="pre">BenchmarkTools.jl</span></code> library</a>:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="n">Pkg</span><span class="p">;</span><span class="w"> </span><span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;BenchmarkTools&quot;</span><span class="p">)</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="n">BenchmarkTools</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">operation</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="nd">@time</span><span class="w"> </span><span class="n">operation</span><span class="o">.</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  0.039672 seconds (119.02 k allocations: 5.585 MiB)





2×2 Array{Float64,2}:
 0.600999  2.49352
 0.280951  2.15671
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">f</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nd">@time</span><span class="w"> </span><span class="n">operation</span><span class="o">.</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="n">f</span><span class="p">()</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  0.000000 seconds (1 allocation: 112 bytes)





2×2 Array{Float64,2}:
 2.31605  2.80158
 1.1832   0.2232
</pre></div>
</div>
<p>Presumably (ref?) should wrap benchmarking operations in functions to ensure we make good use of stack framing, instead of relying on the JIT in the REPL. The <code class="docutils literal notranslate"><span class="pre">&#64;benchmark</span></code> macro provides this behaviour, with additional statistics, and if that is not needed, <code class="docutils literal notranslate"><span class="pre">&#64;btime</span></code> is a better replacement for <code class="docutils literal notranslate"><span class="pre">&#64;time</span></code>:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">println</span><span class="p">(</span><span class="nd">@benchmark</span><span class="w"> </span><span class="n">operation</span><span class="o">.</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Trial(265.835 ns)
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@btime</span><span class="w"> </span><span class="n">operation</span><span class="o">.</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">operation</span><span class="o">.</span><span class="p">(</span><span class="o">$</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c"># interpolate value of x into expression to avoid overhead of globals</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  254.460 ns (7 allocations: 272 bytes)
</pre></div>
</div>
<p>Aside: for more on interpolation, see <a class="reference external" href="https://docs.julialang.org/en/v1/manual/metaprogramming/#man-expression-interpolation-1">documentation here</a>. It can be thought of, in the above example, as writing explicitly the contents of x in <code class="docutils literal notranslate"><span class="pre">[]</span></code> notation.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"></span>
<span class="n">Djl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Diagonal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DiagonalMatrix</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">operation</span><span class="p">(</span><span class="n">Djl</span><span class="p">);</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">operation</span><span class="p">(</span><span class="n">D</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  150.364 ns (3 allocations: 1.77 KiB)
  19.566 μs (4 allocations: 156.41 KiB)
</pre></div>
</div>
</div>
<div class="section" id="specializations-and-speed">
<h2>Specializations and speed<a class="headerlink" href="#specializations-and-speed" title="Permalink to this headline">¶</a></h2>
<p>Julia <em>can</em> be one of the fastest conventional languages (rivaling or nearly outperforming C in certain circumstances). To explore this, let’s use the example case of a <a class="reference external" href="https://en.wikipedia.org/wiki/Vandermonde_matrix">Vandermonde matrix</a>. We’ll begin with comparisons to the Python implementation, and the numpy C-backended library:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nb">ENV</span><span class="p">[</span><span class="s">&quot;PYTHON&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace</span><span class="p">(</span><span class="n">read</span><span class="p">(</span><span class="sb">`which python`</span><span class="p">,</span><span class="w"> </span><span class="kt">String</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"></span>
<span class="k">import</span><span class="w"> </span><span class="n">Pkg</span><span class="p">;</span><span class="w"> </span><span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;PyCall&quot;</span><span class="p">);</span><span class="w"> </span><span class="n">Pkg</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="s">&quot;PyCall&quot;</span><span class="p">)</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="n">PyCall</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[32m[1m  Resolving[22m[39m package versions...
[32m[1m   Updating[22m[39m `~/.julia/environments/v1.4/Project.toml`
[90m [no changes][39m
[32m[1m   Updating[22m[39m `~/.julia/environments/v1.4/Manifest.toml`
[90m [no changes][39m
[32m[1m   Building[22m[39m Conda ─→ `~/.julia/packages/Conda/3rPhK/deps/build.log`
[32m[1m   Building[22m[39m PyCall → `~/.julia/packages/PyCall/zqDXB/deps/build.log`
┌ Info: Precompiling PyCall [438e738f-606a-5dbb-bf0a-cddfbfd45ab0]
└ @ Base loading.jl:1260
WARNING: using PyCall.setindex! in module Main conflicts with an existing identifier.
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyimport</span><span class="p">(</span><span class="s">&quot;numpy&quot;</span><span class="p">)</span><span class="w"></span>
<span class="n">np</span><span class="o">.</span><span class="n">vander</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">increasing</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>5×5 Array{Int64,2}:
 1  1   1    1    1
 1  2   4    8   16
 1  3   9   27   81
 1  4  16   64  256
 1  5  25  125  625
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># julia implementation</span><span class="w"></span>
<span class="k">function</span><span class="w"> </span><span class="n">vander</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">AbstractVector</span><span class="p">{</span><span class="kt">T</span><span class="p">},</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="kt">T</span><span class="w"></span>
<span class="w">    </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Matrix</span><span class="p">{</span><span class="kt">T</span><span class="p">}(</span><span class="nb">undef</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">m</span><span class="w"></span>
<span class="w">        </span><span class="n">V</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="n">n</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">m</span><span class="w"></span>
<span class="w">            </span><span class="n">V</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">V</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">V</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="n">vander</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">5</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>5×5 Array{Int64,2}:
 1  1   1    1    1
 1  2   4    8   16
 1  3   9   27   81
 1  4  16   64  256
 1  5  25  125  625
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">BenchmarkTools</span><span class="p">,</span><span class="w"> </span><span class="n">Plots</span><span class="w"></span>
<span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exp10</span><span class="o">.</span><span class="p">(</span><span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="o">=</span><span class="mi">30</span><span class="p">));</span><span class="w"></span>

<span class="n">tnp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Float64</span><span class="p">[]</span><span class="w"></span>
<span class="n">tjl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Float64</span><span class="p">[]</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ns</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">collect</span><span class="w"></span>
<span class="w">    </span><span class="n">push!</span><span class="p">(</span><span class="n">tnp</span><span class="p">,</span><span class="w"> </span><span class="nd">@belapsed</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">vander</span><span class="p">(</span><span class="o">$</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">samples</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="n">evals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">push!</span><span class="p">(</span><span class="n">tjl</span><span class="p">,</span><span class="w"> </span><span class="nd">@belapsed</span><span class="w"> </span><span class="n">vander</span><span class="p">(</span><span class="o">$</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">samples</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="n">evals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="n">plot</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="w"> </span><span class="n">tnp</span><span class="o">./</span><span class="n">tjl</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">=</span><span class="ss">:circle</span><span class="p">,</span><span class="w"> </span><span class="n">xscale</span><span class="o">=</span><span class="ss">:log10</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;matrix size&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;NumPy time / Julia time&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="o">=</span><span class="ss">:false</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p><img alt="svg" src="../_images/phyiscs-learning_49_0.svg" /></p>
<p>The Julia implementation also works for non-numerical types, as long as a <code class="docutils literal notranslate"><span class="pre">one</span></code> identity is defined, aswell as the multiplication operator.</p>
<div class="section" id="julia-compile-to-run-graph">
<h3>Julia compile-to-run graph<a class="headerlink" href="#julia-compile-to-run-graph" title="Permalink to this headline">¶</a></h3>
<p><img alt="png" src="../_images/from_source_to_native.png" /></p>
<p><strong>AST</strong> = Abstract Syntax Tree</p>
<p><strong>SSA</strong> = Static Single Assignment</p>
<p><strong>LLVM</strong> = Low Level Virtual Machine</p>
</div>
<div class="section" id="specialization-and-code-inspection">
<h3>Specialization and code inspection<a class="headerlink" href="#specialization-and-code-inspection" title="Permalink to this headline">¶</a></h3>
<p>Julia specializes on the function argument types. When a function is <strong>called</strong> for the first time, Julia pre-compiles machine code for the given input types. For <strong>subsequent calls</strong>, the machine code can be reused, until a function with different input types is called. It can therefore be argued that it is benefitial to write specialized functions from the get-go, to limit the need for pre-compilation.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">^</span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"></span>
<span class="nd">@time</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c"># compilation + execution</span><span class="w"></span>
<span class="nd">@time</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c"># just execution</span><span class="w"></span>
<span class="nd">@time</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="mf">1.3</span><span class="p">,</span><span class="w"> </span><span class="mf">4.8</span><span class="p">);</span><span class="w"> </span><span class="c"># compilation for float + execution</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  0.000000 seconds
  0.000000 seconds
  0.000000 seconds





6.49
</pre></div>
</div>
<p>To examine this further, we can inspect the code transformation stages with builtin macros:</p>
<ul class="simple">
<li><p>AST after parsing (<code class="docutils literal notranslate"><span class="pre">&#64;macroexpand</span></code>)</p></li>
<li><p>AST after lowering (<code class="docutils literal notranslate"><span class="pre">&#64;code_typed</span></code>, <code class="docutils literal notranslate"><span class="pre">&#64;code_warntype</span></code>)</p></li>
<li><p>AST after inference and optimization (<code class="docutils literal notranslate"><span class="pre">&#64;code_lowered</span></code>)</p></li>
<li><p>LLVM IR (<code class="docutils literal notranslate"><span class="pre">&#64;code_llvm</span></code>)</p></li>
<li><p>assembly machine code (<code class="docutils literal notranslate"><span class="pre">&#64;code_native</span></code>)</p></li>
</ul>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@code_typed</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CodeInfo(
[90m1 ─[39m %1 = Base.mul_int(x, x)[36m::Int64[39m
[90m│  [39m %2 = Base.add_int(%1, y)[36m::Int64[39m
[90m└──[39m      return %2
) =&gt; Int64
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@code_lowered</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CodeInfo(
[90m1 ─[39m %1 = Core.apply_type(Base.Val, 2)
[90m│  [39m %2 = (%1)()
[90m│  [39m %3 = Base.literal_pow(Main.:^, x, %2)
[90m│  [39m %4 = %3 + y
[90m└──[39m      return %4
)
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@code_llvm</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="nd">@code_llvm</span><span class="w"> </span><span class="n">debuginfo</span><span class="o">=</span><span class="ss">:none</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>;  @ In[89]:1 within `func&#39;
define i64 @julia_func_21948(i64, i64) {
top:
; ┌ @ intfuncs.jl:261 within `literal_pow&#39;
; │┌ @ int.jl:54 within `*&#39;
    %2 = mul i64 %0, %0
; └└
; ┌ @ int.jl:53 within `+&#39;
   %3 = add i64 %2, %1
; └
  ret i64 %3
}

define i64 @julia_func_21952(i64, i64) {
top:
  %2 = mul i64 %0, %0
  %3 = add i64 %2, %1
  ret i64 %3
}
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@code_native</span><span class="w"> </span><span class="n">debuginfo</span><span class="o">=</span><span class="ss">:none</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>	.section	__TEXT,__text,regular,pure_instructions
	imulq	%rdi, %rdi
	leaq	(%rdi,%rsi), %rax
	retq
	nopl	(%rax)
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># compare to float</span><span class="w"></span>
<span class="nd">@code_native</span><span class="w"> </span><span class="n">debuginfo</span><span class="o">=</span><span class="ss">:none</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>	.section	__TEXT,__text,regular,pure_instructions
	vmulsd	%xmm0, %xmm0, %xmm0
	vaddsd	%xmm1, %xmm0, %xmm0
	retq
	nopl	(%rax)
</pre></div>
</div>
</div>
<div class="section" id="estimating-the-performance-gain-of-specialization">
<h3>Estimating the performance gain of specialization<a class="headerlink" href="#estimating-the-performance-gain-of-specialization" title="Permalink to this headline">¶</a></h3>
<p>We’ll wrap our numbers into a custom type <code class="docutils literal notranslate"><span class="pre">Anything</span></code> which stores them as <code class="docutils literal notranslate"><span class="pre">Any</span></code> type to prevent the specialization from occuring (equivalent to Python’s behaviour):</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="kt">Anything</span><span class="w"></span>
<span class="w">    </span><span class="n">value</span><span class="o">::</span><span class="kt">Any</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="n">operation</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Number</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">^</span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="n">operation</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Anything</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="o">^</span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>operation (generic function with 3 methods)
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@btime</span><span class="w"> </span><span class="n">operation</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">operation</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span><span class="w"></span>

<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Anything</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">operation</span><span class="p">(</span><span class="o">$</span><span class="n">x</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  1.704 ns (0 allocations: 0 bytes)
  1.649 ns (0 allocations: 0 bytes)
  57.387 ns (3 allocations: 48 bytes)
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@code_native</span><span class="w"> </span><span class="n">debuginfo</span><span class="o">=</span><span class="ss">:none</span><span class="w"> </span><span class="n">operation</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>	.section	__TEXT,__text,regular,pure_instructions
	pushq	%rax
	vxorps	%xmm1, %xmm1, %xmm1
	vucomisd	%xmm0, %xmm1
	ja	L25
	vmulsd	%xmm0, %xmm0, %xmm1
	vsqrtsd	%xmm0, %xmm0, %xmm0
	vaddsd	%xmm0, %xmm1, %xmm0
	popq	%rax
	retq
L25:
	movabsq	$throw_complex_domainerror, %rax
	movabsq	$4660561416, %rdi       ## imm = 0x115CA8608
	callq	*%rax
	ud2
	nopw	%cs:(%rax,%rax)
	nopl	(%rax,%rax)
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@code_native</span><span class="w"> </span><span class="n">debuginfo</span><span class="o">=</span><span class="ss">:none</span><span class="w"> </span><span class="n">operation</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>	.section	__TEXT,__text,regular,pure_instructions
	pushq	%rbp
	movq	%rsp, %rbp
	pushq	%r15
	pushq	%r14
	pushq	%r13
	pushq	%r12
	pushq	%rbx
	andq	$-32, %rsp
	subq	$96, %rsp
	movq	%rsi, %rbx
	vxorps	%xmm0, %xmm0, %xmm0
	vmovaps	%ymm0, 32(%rsp)
	movq	%rsi, 64(%rsp)
	movabsq	$jl_get_ptls_states_fast, %rax
	vzeroupper
	callq	*%rax
	movq	%rax, %r14
	movq	$8, 32(%rsp)
	movq	(%rax), %rax
	movq	%rax, 40(%rsp)
	leaq	32(%rsp), %rax
	movq	%rax, (%r14)
	movq	(%rbx), %r12
	movq	(%r12), %rax
	movabsq	$jl_system_image_data, %rcx
	movq	%rcx, 8(%rsp)
	movq	%rax, 16(%rsp)
	movabsq	$jl_system_image_data, %rax
	movq	%rax, 24(%rsp)
	movabsq	$jl_apply_generic, %r13
	movabsq	$jl_system_image_data, %rdi
	leaq	8(%rsp), %r15
	movq	%r15, %rsi
	movl	$3, %edx
	callq	*%r13
	movq	%rax, %rbx
	movq	(%r12), %rax
	movq	%rbx, 56(%rsp)
	movq	%rax, 8(%rsp)
	movabsq	$jl_system_image_data, %rdi
	movq	%r15, %rsi
	movl	$1, %edx
	callq	*%r13
	movq	%rax, 48(%rsp)
	movq	%rbx, 8(%rsp)
	movq	%rax, 16(%rsp)
	movabsq	$jl_system_image_data, %rdi
	movq	%r15, %rsi
	movl	$2, %edx
	callq	*%r13
	movq	40(%rsp), %rcx
	movq	%rcx, (%r14)
	leaq	-40(%rbp), %rsp
	popq	%rbx
	popq	%r12
	popq	%r13
	popq	%r14
	popq	%r15
	popq	%rbp
	retq
	nopw	%cs:(%rax,%rax)
	nopl	(%rax,%rax)
</pre></div>
</div>
</div>
<div class="section" id="using-run-time-effectively">
<h3>Using Run-time effectively<a class="headerlink" href="#using-run-time-effectively" title="Permalink to this headline">¶</a></h3>
<p>For numerical computations, we’ll typically run a piece of code many times (c.f. Monte Carlo simulations). It is in our interest to <strong>minimize run-time</strong> as much as we can.</p>
<p>Since Julia compiles a piece of code only once, we can assume our compile-time will be <strong>far shorter</strong> than our run-time. It is a good strategy then to move as much of the logic and computation into compile-time operations. As Julia specializes around types, the only information available at compile-time are <strong>types</strong>.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">f1</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">f2</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span><span class="n">f_slow</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">::</span><span class="kt">Bool</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">p</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">f1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">f2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="nd">@code_llvm</span><span class="w"> </span><span class="n">debuginfo</span><span class="o">=</span><span class="ss">:none</span><span class="w"> </span><span class="n">f_slow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>define i64 @julia_f_slow_22054(i64, i8) {
top:
  %2 = and i8 %1, 1
  %3 = icmp eq i8 %2, 0
  br i1 %3, label %L4, label %L2

L2:                                               ; preds = %top
  %4 = add i64 %0, 1
  ret i64 %4

L4:                                               ; preds = %top
  %5 = add i64 %0, 2
  ret i64 %5
}
</pre></div>
</div>
<p>We could eliminate the if-branch by moving the condition into the type domain, thus it is only evaluated <strong>once</strong> at compile-time:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">abstract</span><span class="w"> </span><span class="k">type</span> <span class="kt">Boolean</span><span class="w"> </span><span class="k">end</span><span class="w"></span>
<span class="k">struct</span> <span class="kt">True</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="c"># type domain true</span><span class="w"></span>
<span class="k">struct</span> <span class="kt">False</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="c"># type domain false</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span><span class="n">f_fast</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">::</span><span class="kt">Boolean</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">typeof</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">True</span><span class="w"> </span><span class="c"># check solely based on the type of p</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">f1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">f2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="nd">@code_llvm</span><span class="w"> </span><span class="n">debuginfo</span><span class="o">=</span><span class="ss">:none</span><span class="w"> </span><span class="n">f_fast</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">True</span><span class="p">())</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>define i64 @julia_f_fast_22057(i64) {
top:
  %1 = add i64 %0, 1
  ret i64 %1
}
</pre></div>
</div>
<p>Somewhat contrary to my earlier assumption, specifying types is not <strong>always</strong> necessary for the best performance; consider:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">my_function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span><span class="n">my_function_typed</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Int</span><span class="p">)</span><span class="o">::</span><span class="kt">Float64</span><span class="w"></span>
<span class="w">    </span><span class="n">y</span><span class="o">::</span><span class="kt">Float64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">z</span><span class="o">::</span><span class="kt">Float64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="nd">@btime</span><span class="w"> </span><span class="n">my_function</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">my_function_typed</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  9.790 ns (0 allocations: 0 bytes)
  9.802 ns (0 allocations: 0 bytes)
</pre></div>
</div>
<p>The implicit benefit of type annotations however can be to help define user interface, enforce conversions, and (in rare situations), aid the compiler in infer tricky situations.</p>
</div>
</div>
<div class="section" id="generic-programming">
<h2>Generic programming<a class="headerlink" href="#generic-programming" title="Permalink to this headline">¶</a></h2>
<p>From Wikipedia:</p>
<blockquote>
<div><p>Generic programming is a style of computer programming in which algorithms are written in terms of types to-be-specified-later that are then instantiated when needed for specific types provided as parameters.</p>
</div></blockquote>
<p>Let us revist the example of the Vandermonde matrix:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">vander_naive</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Vector</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Matrix</span><span class="p">{</span><span class="kt">Float64</span><span class="p">}(</span><span class="nb">undef</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">m</span><span class="w"></span>
<span class="w">        </span><span class="n">V</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="n">m</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">m</span><span class="w"></span>
<span class="w">            </span><span class="n">V</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">V</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">V</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="nd">@show</span><span class="w"> </span><span class="n">vander_naive</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="w"> </span><span class="n">vander_naive</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">3</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">collect</span><span class="p">)</span><span class="w"></span>
<span class="n">vander_naive</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">])</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>vander_naive(rand(3)) = [1.0 0.4848992674566619 0.23512729958000733; 1.0 0.9291247271286742 0.8632727585619333; 1.0 0.02320103162999887 0.000538287868696208]
vander_naive(1:3 |&gt; collect) = [1.0 1.0 1.0; 1.0 2.0 4.0; 1.0 3.0 9.0]





3×3 Array{Float64,2}:
 1.0  1.0  1.0
 1.0  2.0  4.0
 1.0  3.0  9.0
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">vander_naive</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="kt">ComplexF64</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>InexactError: Float64(0.8485448902137205 + 0.45123885929324126im)



Stacktrace:

 [1] Real at ./complex.jl:37 [inlined]

 [2] convert at ./number.jl:7 [inlined]

 [3] setindex! at ./array.jl:828 [inlined]

 [4] vander_naive(::Array{Complex{Float64},1}) at ./In[111]:9

 [5] top-level scope at In[112]:1
</pre></div>
</div>
<p>Note that despite our broad use of <code class="docutils literal notranslate"><span class="pre">x::Vector</span></code> for type hierarchy, we result in floating point Matrices, or, in the case of complex valued inputs, errors. We want to instead then</p>
<ul class="simple">
<li><p>keep function arg types generic if possible</p></li>
<li><p>avoid explicit typing if possible</p></li>
</ul>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">vander_generic</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">AbstractVector</span><span class="p">{</span><span class="kt">T</span><span class="p">})</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="kt">T</span><span class="w"></span>
<span class="w">    </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Matrix</span><span class="p">{</span><span class="kt">T</span><span class="p">}(</span><span class="nb">undef</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">m</span><span class="w"></span>
<span class="w">        </span><span class="n">V</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="n">m</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">m</span><span class="w"></span>
<span class="w">            </span><span class="n">V</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">V</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="w">            </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">V</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="n">vander_generic</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Stadt&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span><span class="nb">im</span><span class="p">])</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>3×3 Array{Any,2}:
  1      3           9
   &quot;&quot;     &quot;Stadt&quot;     &quot;StadtStadt&quot;
 1+0im  4+5im      -9+40im
</pre></div>
</div>
<p>From a performance perspective, the generic form is actually <strong>faster</strong>, since it does not need to perform type conversions as often. However, in the cases of using odd data types, such as <code class="docutils literal notranslate"><span class="pre">Float32</span></code> (not atomic on modern hardware) it can be performance benifitial to perform a type conversion:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">(</span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">vander_naive</span><span class="p">(</span><span class="o">$</span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">vander_generic</span><span class="p">(</span><span class="o">$</span><span class="n">x</span><span class="p">);</span><span class="w"></span>

<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">(</span><span class="kt">Float32</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">vander_naive</span><span class="p">(</span><span class="o">$</span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">vander_generic</span><span class="p">(</span><span class="o">$</span><span class="n">x</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  10.278 μs (2 allocations: 78.20 KiB)
  7.677 μs (2 allocations: 78.20 KiB)
  10.053 μs (2 allocations: 78.20 KiB)
  22.117 μs (2 allocations: 39.14 KiB)
</pre></div>
</div>
<div class="section" id="generic-programming-with-multiple-dispatch-and-jit">
<h3>Generic Programming with Multiple Dispatch and JIT<a class="headerlink" href="#generic-programming-with-multiple-dispatch-and-jit" title="Permalink to this headline">¶</a></h3>
<p>Generic algorithms that compile to fast machine code in combination with multiple dispatch can lead to a large amount of code reuse (see <a class="reference external" href="https://www.youtube.com/watch?v=kc9HwsxE1OY">YouTube Video from JuliaCon 19 here</a>).</p>
<p>Code sharing comes as either: <strong>1. Sharing generic algorithms</strong>, where methods are selected based on all argument types, and <strong>2. Sharing types</strong> where you define methods on types <em>after</em> the type is defined.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="n">Pkg</span><span class="p">;</span><span class="w"> </span><span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;WebIO&quot;</span><span class="p">)</span><span class="w"></span>
<span class="k">import</span><span class="w"> </span><span class="n">Pkg</span><span class="p">;</span><span class="w"> </span><span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;Interact&quot;</span><span class="p">)</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="n">WebIO</span><span class="w"></span>
<span class="c"># WebIO.install_jupyter_labextension()</span><span class="w"></span>
<span class="n">WebIO</span><span class="o">.</span><span class="n">install_jupyter_nbextension</span><span class="p">()</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="n">Interact</span><span class="w"></span>
<span class="c"># requires a `pip install jupyter_contrib_nbextensions`</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@manipulate</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">20</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">j</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="p">]</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">insert_block</span><span class="p">(</span><span class="n">A</span><span class="o">::</span><span class="kt">AbstractMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">what</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">copy</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="o">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">:</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">.=</span><span class="w"> </span><span class="n">what</span><span class="w"></span>
<span class="w">    </span><span class="n">B</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fill</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="c"># create 9x9 array filled with 0s</span><span class="w"></span>
<span class="n">insert_block</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="c"># creates a new Matrix</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>9×9 Array{Int64,2}:
 0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0
 0  0  0  0  7  7  7  0  0
 0  0  0  0  7  7  7  0  0
 0  0  0  0  7  7  7  0  0
 0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fill</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"></span>
<span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>

<span class="nd">@manipulate</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="w"></span>
<span class="w">    </span><span class="n">insert_block</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="n">Pkg</span><span class="p">;</span><span class="w"> </span><span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;Colors&quot;</span><span class="p">)</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="n">Colors</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@manipulate</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">80</span><span class="w"></span>
<span class="w">    </span><span class="n">distinguishable_colors</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">distinguishable_colors</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"></span>
<span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
</pre></div>
</div>
<p><img alt="svg" src="../_images/phyiscs-learning_85_0.svg" /></p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fill</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"></span>
<span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="nd">@manipulate</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="w"></span>
<span class="w">    </span><span class="n">insert_block</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">colors</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="example-differentialequations-jl">
<h3>Example: DifferentialEquations.jl<a class="headerlink" href="#example-differentialequations-jl" title="Permalink to this headline">¶</a></h3>
<p>Lets examine differentials in the form
$<span class="math notranslate nohighlight">\(\frac{du}{dt} = f(u,p,t)\)</span>$</p>
<p>For example, half life equations with
$<span class="math notranslate nohighlight">\(\frac{du}{dt} = - \lambda t\)</span><span class="math notranslate nohighlight">\(
where \)</span>\lambda<span class="math notranslate nohighlight">\( is the associated half-life, and we feed some \)</span>u(0)=N_0$ as the initial number of atoms.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="n">Pkg</span><span class="p">;</span><span class="w"> </span><span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;OrdinaryDiffEq&quot;</span><span class="p">)</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="n">OrdinaryDiffEq</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># half life of carbon is 5730 years</span><span class="w"></span>
<span class="n">hfl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.730</span><span class="w"></span>

<span class="c"># Initial conditions</span><span class="w"></span>
<span class="n">n0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"></span>
<span class="n">tspan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"></span>

<span class="c"># define the problem</span><span class="w"></span>
<span class="n">radioactiveDecay</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">hfl</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u</span><span class="w"></span>

<span class="c"># pass to the solver</span><span class="w"></span>
<span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ODEProblem</span><span class="p">(</span><span class="n">radioactiveDecay</span><span class="p">,</span><span class="w"> </span><span class="n">n0</span><span class="p">,</span><span class="w"> </span><span class="n">tspan</span><span class="p">)</span><span class="w"></span>
<span class="n">sol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solve</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span><span class="w"> </span><span class="n">Tsit5</span><span class="p">(),</span><span class="w"> </span><span class="n">reltol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span><span class="w"> </span><span class="n">abstol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">);</span><span class="w"></span>

<span class="k">using</span><span class="w"> </span><span class="n">Plots</span><span class="w"></span>
<span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">sol</span><span class="o">.</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;u(t)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;t&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="o">=</span><span class="nb">false</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p><img alt="svg" src="../_images/phyiscs-learning_89_0.svg" /></p>
<p>Now with arbitrary precision:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="n">Pkg</span><span class="p">;</span><span class="w"> </span><span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;Measurements&quot;</span><span class="p">)</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="n">Measurements</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">hfl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">big</span><span class="p">(</span><span class="mf">5.730</span><span class="p">)</span><span class="w"> </span><span class="c"># now a BigFloat</span><span class="w"></span>
<span class="n">n0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">big</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span><span class="w"></span>

<span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ODEProblem</span><span class="p">(</span><span class="n">radioactiveDecay</span><span class="p">,</span><span class="w"> </span><span class="n">n0</span><span class="p">,</span><span class="w"> </span><span class="n">tspan</span><span class="p">)</span><span class="w"></span>
<span class="n">sol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solve</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span><span class="w"> </span><span class="n">Tsit5</span><span class="p">(),</span><span class="w"> </span><span class="n">reltol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span><span class="w"> </span><span class="n">abstol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span><span class="w"></span>
<span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">sol</span><span class="o">.</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;u(t)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;t&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="o">=</span><span class="nb">false</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p><img alt="svg" src="../_images/phyiscs-learning_92_0.svg" /></p>
<p>Now using unccertainties from Measurements.jl:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.730</span><span class="w"> </span><span class="o">±</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="n">n0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">±</span><span class="w"> </span><span class="mf">0.1</span><span class="w"></span>

<span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ODEProblem</span><span class="p">(</span><span class="n">radioactiveDecay</span><span class="p">,</span><span class="w"> </span><span class="n">n0</span><span class="p">,</span><span class="w"> </span><span class="n">tspan</span><span class="p">)</span><span class="w"></span>
<span class="n">sol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solve</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span><span class="w"> </span><span class="n">Tsit5</span><span class="p">(),</span><span class="w"> </span><span class="n">reltol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span><span class="w"> </span><span class="n">abstol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span><span class="w"></span>
<span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">sol</span><span class="o">.</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;u(t)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;t&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="o">=</span><span class="nb">false</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p><img alt="svg" src="../_images/phyiscs-learning_94_0.svg" /></p>
<p>If you wanted to do that yourself, it would be a lot more code.</p>
<p>Generic Programming with Multiple Dispatch and JIT = <strong>lots of code sharing and emergent features</strong>.</p>
</div>
</div>
<div class="section" id="gotchas-and-how-to-handle-them">
<h2><em>Gotchas</em> and how to handle them<a class="headerlink" href="#gotchas-and-how-to-handle-them" title="Permalink to this headline">¶</a></h2>
<div class="section" id="gotcha-1-global-scope">
<h3>Gotcha 1: Global scope<a class="headerlink" href="#gotcha-1-global-scope" title="Permalink to this headline">¶</a></h3>
<p>In the following code extract, the REPL/global scope does not guaruntee that <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are of a certain type.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="w"></span>
<span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.0</span><span class="w"></span>
<span class="k">function</span><span class="w"> </span><span class="n">linearcombo</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="n">answer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linearcombo</span><span class="p">()</span><span class="w"></span>

<span class="nd">@show</span><span class="w"> </span><span class="n">answer</span><span class="w"></span>
<span class="nd">@code_llvm</span><span class="w"> </span><span class="n">linearcombo</span><span class="p">()</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>answer = 7.0

;  @ In[37]:4 within `linearcombo&#39;
define nonnull %jl_value_t addrspace(10)* @julia_linearcombo_21863() {
top:
  %0 = alloca %jl_value_t addrspace(10)*, i32 2
  %gcframe = alloca %jl_value_t addrspace(10)*, i32 4, align 16
  %1 = bitcast %jl_value_t addrspace(10)** %gcframe to i8*
  call void @llvm.memset.p0i8.i32(i8* align 16 %1, i8 0, i32 32, i1 false)
  %2 = call %jl_value_t*** inttoptr (i64 4480686656 to %jl_value_t*** ()*)() #4
  %3 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %gcframe, i32 0
  %4 = bitcast %jl_value_t addrspace(10)** %3 to i64*
  store i64 8, i64* %4
  %5 = getelementptr %jl_value_t**, %jl_value_t*** %2, i32 0
  %6 = load %jl_value_t**, %jl_value_t*** %5
  %7 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %gcframe, i32 1
  %8 = bitcast %jl_value_t addrspace(10)** %7 to %jl_value_t***
  store %jl_value_t** %6, %jl_value_t*** %8
  %9 = bitcast %jl_value_t*** %5 to %jl_value_t addrspace(10)***
  store %jl_value_t addrspace(10)** %gcframe, %jl_value_t addrspace(10)*** %9
  %10 = load %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** inttoptr (i64 5371365512 to %jl_value_t addrspace(10)**), align 8
  %11 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %gcframe, i32 2
  store %jl_value_t addrspace(10)* %10, %jl_value_t addrspace(10)** %11
  %12 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %0, i32 0
  store %jl_value_t addrspace(10)* addrspacecast (%jl_value_t* inttoptr (i64 4610244768 to %jl_value_t*) to %jl_value_t addrspace(10)*), %jl_value_t addrspace(10)** %12
  %13 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %0, i32 1
  store %jl_value_t addrspace(10)* %10, %jl_value_t addrspace(10)** %13
  %14 = call nonnull %jl_value_t addrspace(10)* @jl_apply_generic(%jl_value_t addrspace(10)* addrspacecast (%jl_value_t* inttoptr (i64 4742542880 to %jl_value_t*) to %jl_value_t addrspace(10)*), %jl_value_t addrspace(10)** %0, i32 2)
  %15 = load %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** inttoptr (i64 5371369928 to %jl_value_t addrspace(10)**), align 8
  %16 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %gcframe, i32 3
  store %jl_value_t addrspace(10)* %14, %jl_value_t addrspace(10)** %16
  %17 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %gcframe, i32 2
  store %jl_value_t addrspace(10)* %15, %jl_value_t addrspace(10)** %17
  %18 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %0, i32 0
  store %jl_value_t addrspace(10)* %14, %jl_value_t addrspace(10)** %18
  %19 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %0, i32 1
  store %jl_value_t addrspace(10)* %15, %jl_value_t addrspace(10)** %19
  %20 = call nonnull %jl_value_t addrspace(10)* @jl_apply_generic(%jl_value_t addrspace(10)* addrspacecast (%jl_value_t* inttoptr (i64 4734288816 to %jl_value_t*) to %jl_value_t addrspace(10)*), %jl_value_t addrspace(10)** %0, i32 2)
  %21 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %gcframe, i32 1
  %22 = load %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %21
  %23 = getelementptr %jl_value_t**, %jl_value_t*** %2, i32 0
  %24 = bitcast %jl_value_t*** %23 to %jl_value_t addrspace(10)**
  store %jl_value_t addrspace(10)* %22, %jl_value_t addrspace(10)** %24
  ret %jl_value_t addrspace(10)* %20
}
</pre></div>
</div>
<p>To assist in identifying and avoiding this issue, we can use <a class="reference external" href="https://github.com/MikeInnes/Traceur.jl">Traceur.jl</a>, a codified version of the <a class="reference external" href="https://docs.julialang.org/en/v0.6.4/manual/performance-tips/#man-performance-tips-1">performance tips</a> in the offical Julia documentation:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="n">Pkg</span><span class="p">;</span><span class="w"> </span><span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;Traceur&quot;</span><span class="p">)</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="n">Traceur</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@trace</span><span class="w"> </span><span class="n">linearcombo</span><span class="p">()</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>┌ Warning: uses global variable Main.a
└ @ In[37]:-1
┌ Warning: uses global variable Main.b
└ @ In[37]:-1
┌ Warning: dynamic dispatch to 2 * Main.a
└ @ In[37]:-1
┌ Warning: dynamic dispatch to 2 * Main.a + Main.b
└ @ In[37]:-1
┌ Warning: linearcombo returns Any
└ @ In[37]:4





7.0
</pre></div>
</div>
<div class="section" id="solution-1-wrap-code-in-functions">
<h4>Solution 1: Wrap code in functions<a class="headerlink" href="#solution-1-wrap-code-in-functions" title="Permalink to this headline">¶</a></h4>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">outer</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">a</span><span class="o">=</span><span class="mf">2.0</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="mf">3.0</span><span class="w"></span>
<span class="w">    </span><span class="k">function</span><span class="w"> </span><span class="n">linearcombo</span><span class="p">()</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">linearcombo</span><span class="p">()</span><span class="w"> </span>
<span class="k">end</span><span class="w"></span>

<span class="n">answer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">outer</span><span class="p">()</span><span class="w"></span>

<span class="nd">@show</span><span class="w"> </span><span class="n">answer</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>answer = 7.0
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@code_llvm</span><span class="w"> </span><span class="n">outer</span><span class="p">()</span><span class="w"></span>
<span class="nd">@trace</span><span class="w"> </span><span class="n">outer</span><span class="p">()</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>;  @ In[41]:2 within `outer&#39;
define double @julia_outer_22595() {
top:
  ret double 7.000000e+00
}





7.0
</pre></div>
</div>
<p>This is about as fast as Julia can be; it’s just returning a literal.</p>
</div>
<div class="section" id="solution-2-declare-globals-as-compile-time-constants">
<h4>Solution 2: Declare globals as (compile-time) constants<a class="headerlink" href="#solution-2-declare-globals-as-compile-time-constants" title="Permalink to this headline">¶</a></h4>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="n">Aa</span><span class="o">=</span><span class="mf">2.0</span><span class="w"></span>
<span class="k">const</span><span class="w"> </span><span class="n">Bb</span><span class="o">=</span><span class="mf">3.0</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span><span class="n">Linearcombo</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="n">Aa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Bb</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="n">answer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Linearcombo</span><span class="p">()</span><span class="w"></span>

<span class="nd">@show</span><span class="w"> </span><span class="n">answer</span><span class="w"></span>
<span class="nd">@code_llvm</span><span class="w"> </span><span class="n">Linearcombo</span><span class="p">()</span><span class="w"></span>
<span class="nd">@trace</span><span class="w"> </span><span class="n">Linearcombo</span><span class="p">()</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>answer = 7.0

;  @ In[45]:5 within `Linearcombo&#39;
define double @julia_Linearcombo_22692() {
top:
  ret double 7.000000e+00
}





7.0
</pre></div>
</div>
<p><strong>NB</strong>: these are only compile-time constants, so can be modified:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="n">Aa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"></span>
<span class="n">Linearcombo</span><span class="p">()</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>WARNING: redefining constant Aa





7.0
</pre></div>
</div>
</div>
</div>
<div class="section" id="gotcha-2-type-instabilities">
<h3>Gotcha 2: Type-instabilities<a class="headerlink" href="#gotcha-2-type-instabilities" title="Permalink to this headline">¶</a></h3>
<p>There’s a bad performance aspect in the implentation of the following code:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">g</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">10</span><span class="w"></span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">/</span><span class="mi">2</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="nd">@code_llvm</span><span class="w"> </span><span class="n">debuginfo</span><span class="o">=</span><span class="ss">:none</span><span class="w"> </span><span class="n">g</span><span class="p">()</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>define double @julia_g_22720() {
top:
  br label %L2

L2:                                               ; preds = %top, %L29
  %0 = phi double [ 4.940660e-324, %top ], [ %value_phi1, %L29 ]
  %.sroa.011.0 = phi i64 [ 1, %top ], [ %4, %L29 ]
  %tindex_phi = phi i8 [ 2, %top ], [ 1, %L29 ]
  %value_phi = phi i64 [ 1, %top ], [ %3, %L29 ]
  switch i8 %tindex_phi, label %L17 [
    i8 2, label %L6
    i8 1, label %L19
  ]

L6:                                               ; preds = %L2
  %1 = sitofp i64 %.sroa.011.0 to double
  br label %L19

L17:                                              ; preds = %L2
  call void @jl_throw(%jl_value_t addrspace(12)* addrspacecast (%jl_value_t* inttoptr (i64 4699507808 to %jl_value_t*) to %jl_value_t addrspace(12)*))
  unreachable

L19:                                              ; preds = %L2, %L6
  %value_phi1.in = phi double [ %1, %L6 ], [ %0, %L2 ]
  %value_phi1 = fmul double %value_phi1.in, 5.000000e-01
  %2 = icmp eq i64 %value_phi, 10
  br i1 %2, label %L25.L30_crit_edge, label %L29

L25.L30_crit_edge:                                ; preds = %L19
  ret double %value_phi1

L29:                                              ; preds = %L19
  %3 = add nuw nsw i64 %value_phi, 1
  %4 = bitcast double %value_phi1 to i64
  br label %L2
}
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># more drastically</span><span class="w"></span>
<span class="n">f</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;3&quot;</span><span class="p">])</span><span class="w"></span>
<span class="nd">@code_llvm</span><span class="w"> </span><span class="n">debuginfo</span><span class="o">=</span><span class="ss">:none</span><span class="w"> </span><span class="n">f</span><span class="p">()</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>define nonnull %jl_value_t addrspace(10)* @julia_f_22726() {
top:
  %0 = alloca %jl_value_t addrspace(10)*, i32 2
  %gcframe = alloca %jl_value_t addrspace(10)*, i32 4, align 16
  %1 = bitcast %jl_value_t addrspace(10)** %gcframe to i8*
  call void @llvm.memset.p0i8.i32(i8* align 16 %1, i8 0, i32 32, i1 false)
  %2 = alloca [4 x i64], align 8
  %3 = call %jl_value_t*** inttoptr (i64 4480686656 to %jl_value_t*** ()*)() #8
  %4 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %gcframe, i32 0
  %5 = bitcast %jl_value_t addrspace(10)** %4 to i64*
  store i64 8, i64* %5
  %6 = getelementptr %jl_value_t**, %jl_value_t*** %3, i32 0
  %7 = load %jl_value_t**, %jl_value_t*** %6
  %8 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %gcframe, i32 1
  %9 = bitcast %jl_value_t addrspace(10)** %8 to %jl_value_t***
  store %jl_value_t** %7, %jl_value_t*** %9
  %10 = bitcast %jl_value_t*** %6 to %jl_value_t addrspace(10)***
  store %jl_value_t addrspace(10)** %gcframe, %jl_value_t addrspace(10)*** %10
  %11 = bitcast %jl_value_t*** %3 to i8*
  %12 = call noalias nonnull %jl_value_t addrspace(10)* @jl_gc_pool_alloc(i8* %11, i32 1424, i32 32) #1
  %13 = bitcast %jl_value_t addrspace(10)* %12 to %jl_value_t addrspace(10)* addrspace(10)*
  %14 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)* addrspace(10)* %13, i64 -1
  store %jl_value_t addrspace(10)* addrspacecast (%jl_value_t* inttoptr (i64 5382042432 to %jl_value_t*) to %jl_value_t addrspace(10)*), %jl_value_t addrspace(10)* addrspace(10)* %14
  %15 = addrspacecast %jl_value_t addrspace(10)* %12 to %jl_value_t addrspace(11)*
  %16 = bitcast %jl_value_t addrspace(10)* %12 to double addrspace(10)*
  store double 1.000000e+00, double addrspace(10)* %16, align 8
  %17 = bitcast %jl_value_t addrspace(11)* %15 to i8 addrspace(11)*
  %18 = getelementptr inbounds i8, i8 addrspace(11)* %17, i64 8
  %19 = bitcast i8 addrspace(11)* %18 to i64 addrspace(11)*
  store i64 2, i64 addrspace(11)* %19, align 8
  %20 = getelementptr inbounds i8, i8 addrspace(11)* %17, i64 16
  %21 = bitcast i8 addrspace(11)* %20 to %jl_value_t addrspace(10)* addrspace(11)*
  store %jl_value_t addrspace(10)* addrspacecast (%jl_value_t* inttoptr (i64 4576865936 to %jl_value_t*) to %jl_value_t addrspace(10)*), %jl_value_t addrspace(10)* addrspace(11)* %21, align 8
  %22 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %gcframe, i32 2
  store %jl_value_t addrspace(10)* %12, %jl_value_t addrspace(10)** %22
  %23 = call %jl_value_t addrspace(10)* inttoptr (i64 4480557376 to %jl_value_t addrspace(10)* (%jl_value_t addrspace(10)*, i64)*)(%jl_value_t addrspace(10)* addrspacecast (%jl_value_t* inttoptr (i64 4698282288 to %jl_value_t*) to %jl_value_t addrspace(10)*), i64 3)
  %24 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %gcframe, i32 3
  store %jl_value_t addrspace(10)* %23, %jl_value_t addrspace(10)** %24
  %25 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %0, i32 0
  store %jl_value_t addrspace(10)* %23, %jl_value_t addrspace(10)** %25
  %26 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %0, i32 1
  store %jl_value_t addrspace(10)* %12, %jl_value_t addrspace(10)** %26
  %27 = call nonnull %jl_value_t addrspace(10)* @&quot;japi1_copyto!_22727&quot;(%jl_value_t addrspace(10)* addrspacecast (%jl_value_t* inttoptr (i64 4745696544 to %jl_value_t*) to %jl_value_t addrspace(10)*), %jl_value_t addrspace(10)** %0, i32 2)
  %28 = getelementptr %jl_value_t**, %jl_value_t*** %3, i64 2
  %29 = bitcast %jl_value_t*** %28 to i16*
  %30 = load i16, i16* %29, align 2
  %31 = sext i16 %30 to i64
  %32 = add nsw i64 %31, 1
  %33 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %gcframe, i32 3
  store %jl_value_t addrspace(10)* %27, %jl_value_t addrspace(10)** %33
  %34 = call nonnull %jl_value_t addrspace(10)* @julia_default_rng_19669(i64 %32)
  %35 = addrspacecast %jl_value_t addrspace(10)* %27 to %jl_value_t addrspace(11)*
  %36 = bitcast %jl_value_t addrspace(11)* %35 to %jl_value_t addrspace(10)* addrspace(11)*
  %37 = getelementptr inbounds %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)* addrspace(11)* %36, i64 3
  %38 = bitcast %jl_value_t addrspace(10)* addrspace(11)* %37 to i64 addrspace(11)*
  %39 = load i64, i64 addrspace(11)* %38, align 8
  %40 = icmp sgt i64 %39, 0
  br i1 %40, label %L19, label %L16

L16:                                              ; preds = %top
  %41 = call noalias nonnull %jl_value_t addrspace(10)* @jl_gc_pool_alloc(i8* %11, i32 1400, i32 16) #1
  %42 = bitcast %jl_value_t addrspace(10)* %41 to %jl_value_t addrspace(10)* addrspace(10)*
  %43 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)* addrspace(10)* %42, i64 -1
  store %jl_value_t addrspace(10)* addrspacecast (%jl_value_t* inttoptr (i64 4699479984 to %jl_value_t*) to %jl_value_t addrspace(10)*), %jl_value_t addrspace(10)* addrspace(10)* %43
  %44 = bitcast %jl_value_t addrspace(10)* %41 to %jl_value_t addrspace(10)* addrspace(10)*
  store %jl_value_t addrspace(10)* addrspacecast (%jl_value_t* inttoptr (i64 4717946176 to %jl_value_t*) to %jl_value_t addrspace(10)*), %jl_value_t addrspace(10)* addrspace(10)* %44, align 8
  %45 = addrspacecast %jl_value_t addrspace(10)* %41 to %jl_value_t addrspace(12)*
  %46 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %gcframe, i32 2
  store %jl_value_t addrspace(10)* %41, %jl_value_t addrspace(10)** %46
  call void @jl_throw(%jl_value_t addrspace(12)* %45)
  unreachable

L19:                                              ; preds = %top
  %47 = add i64 %39, -1
  %48 = call i64 @llvm.ctlz.i64(i64 %47, i1 false)
  %49 = sub nsw i64 64, %48
  %50 = icmp ugt i64 %49, 63
  %notmask = shl nsw i64 -1, %49
  %.op = xor i64 %notmask, -1
  %51 = select i1 %50, i64 -1, i64 %.op
  %52 = getelementptr inbounds [4 x i64], [4 x i64]* %2, i64 0, i64 0
  store i64 1, i64* %52, align 8
  %53 = getelementptr inbounds [4 x i64], [4 x i64]* %2, i64 0, i64 1
  store i64 %49, i64* %53, align 8
  %54 = getelementptr inbounds [4 x i64], [4 x i64]* %2, i64 0, i64 2
  store i64 %47, i64* %54, align 8
  %55 = getelementptr inbounds [4 x i64], [4 x i64]* %2, i64 0, i64 3
  store i64 %51, i64* %55, align 8
  %56 = addrspacecast [4 x i64]* %2 to [4 x i64] addrspace(11)*
  %57 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %gcframe, i32 2
  store %jl_value_t addrspace(10)* %34, %jl_value_t addrspace(10)** %57
  %58 = call i64 @julia_rand_6222(%jl_value_t addrspace(10)* nonnull %34, [4 x i64] addrspace(11)* nocapture readonly %56)
  %59 = add i64 %58, -1
  %60 = bitcast %jl_value_t addrspace(11)* %35 to %jl_value_t addrspace(10)* addrspace(13)* addrspace(11)*
  %61 = load %jl_value_t addrspace(10)* addrspace(13)*, %jl_value_t addrspace(10)* addrspace(13)* addrspace(11)* %60, align 8
  %62 = getelementptr inbounds %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)* addrspace(13)* %61, i64 %59
  %63 = load %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)* addrspace(13)* %62, align 8
  %64 = icmp eq %jl_value_t addrspace(10)* %63, null
  br i1 %64, label %fail, label %pass

fail:                                             ; preds = %L19
  call void @jl_throw(%jl_value_t addrspace(12)* addrspacecast (%jl_value_t* inttoptr (i64 4700982352 to %jl_value_t*) to %jl_value_t addrspace(12)*))
  unreachable

pass:                                             ; preds = %L19
  %65 = getelementptr %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %gcframe, i32 1
  %66 = load %jl_value_t addrspace(10)*, %jl_value_t addrspace(10)** %65
  %67 = getelementptr %jl_value_t**, %jl_value_t*** %3, i32 0
  %68 = bitcast %jl_value_t*** %67 to %jl_value_t addrspace(10)**
  store %jl_value_t addrspace(10)* %66, %jl_value_t addrspace(10)** %68
  ret %jl_value_t addrspace(10)* %63
}
</pre></div>
</div>
<div class="section" id="solution-1-avoid-type-changes">
<h4>Solution 1: Avoid type changes<a class="headerlink" href="#solution-1-avoid-type-changes" title="Permalink to this headline">¶</a></h4>
<p>Init <code class="docutils literal notranslate"><span class="pre">x</span></code> as <code class="docutils literal notranslate"><span class="pre">Float64</span></code> and it’s fast again:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">h</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="o">=</span><span class="mf">1.0</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">10</span><span class="w"></span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">/</span><span class="mi">2</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="nd">@code_llvm</span><span class="w"> </span><span class="n">debuginfo</span><span class="o">=</span><span class="ss">:none</span><span class="w"> </span><span class="n">h</span><span class="p">()</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>define double @julia_h_22728() {
top:
  ret double 0x3F50000000000000
}
</pre></div>
</div>
</div>
<div class="section" id="solution-2-detect-issues-with-code-warntype-or-trace">
<h4>Solution 2: Detect issues with <code class="docutils literal notranslate"><span class="pre">&#64;code_warntype</span></code> or <code class="docutils literal notranslate"><span class="pre">&#64;trace</span></code><a class="headerlink" href="#solution-2-detect-issues-with-code-warntype-or-trace" title="Permalink to this headline">¶</a></h4>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@code_warntype</span><span class="w"> </span><span class="n">g</span><span class="p">()</span><span class="w"></span>
<span class="nd">@code_warntype</span><span class="w"> </span><span class="n">h</span><span class="p">()</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Variables
  #self#[36m::Core.Compiler.Const(g, false)[39m
  x[91m[1m::Union{Float64, Int64}[22m[39m
  @_3[33m[1m::Union{Nothing, Tuple{Int64,Int64}}[22m[39m
  i[36m::Int64[39m

Body[36m::Float64[39m
[90m1 ─[39m       (x = 1)
[90m│  [39m %2  = (1:10)[36m::Core.Compiler.Const(1:10, false)[39m
[90m│  [39m       (@_3 = Base.iterate(%2))
[90m│  [39m %4  = (@_3::Core.Compiler.Const((1, 1), false) === nothing)[36m::Core.Compiler.Const(false, false)[39m
[90m│  [39m %5  = Base.not_int(%4)[36m::Core.Compiler.Const(true, false)[39m
[90m└──[39m       goto #4 if not %5
[90m2 ┄[39m %7  = @_3::Tuple{Int64,Int64}[36m::Tuple{Int64,Int64}[39m
[90m│  [39m       (i = Core.getfield(%7, 1))
[90m│  [39m %9  = Core.getfield(%7, 2)[36m::Int64[39m
[90m│  [39m       (x = x / 2)
[90m│  [39m       (@_3 = Base.iterate(%2, %9))
[90m│  [39m %12 = (@_3 === nothing)[36m::Bool[39m
[90m│  [39m %13 = Base.not_int(%12)[36m::Bool[39m
[90m└──[39m       goto #4 if not %13
[90m3 ─[39m       goto #2
[90m4 ┄[39m       return x::Float64
Variables
  #self#[36m::Core.Compiler.Const(h, false)[39m
  x[36m::Float64[39m
  @_3[33m[1m::Union{Nothing, Tuple{Int64,Int64}}[22m[39m
  i[36m::Int64[39m

Body[36m::Float64[39m
[90m1 ─[39m       (x = 1.0)
[90m│  [39m %2  = (1:10)[36m::Core.Compiler.Const(1:10, false)[39m
[90m│  [39m       (@_3 = Base.iterate(%2))
[90m│  [39m %4  = (@_3::Core.Compiler.Const((1, 1), false) === nothing)[36m::Core.Compiler.Const(false, false)[39m
[90m│  [39m %5  = Base.not_int(%4)[36m::Core.Compiler.Const(true, false)[39m
[90m└──[39m       goto #4 if not %5
[90m2 ┄[39m %7  = @_3::Tuple{Int64,Int64}[36m::Tuple{Int64,Int64}[39m
[90m│  [39m       (i = Core.getfield(%7, 1))
[90m│  [39m %9  = Core.getfield(%7, 2)[36m::Int64[39m
[90m│  [39m       (x = x / 2)
[90m│  [39m       (@_3 = Base.iterate(%2, %9))
[90m│  [39m %12 = (@_3 === nothing)[36m::Bool[39m
[90m│  [39m %13 = Base.not_int(%12)[36m::Bool[39m
[90m└──[39m       goto #4 if not %13
[90m3 ─[39m       goto #2
[90m4 ┄[39m       return x
</pre></div>
</div>
</div>
<div class="section" id="solution-3-c-fortran-type-specifications">
<h4>Solution 3: C/Fortran type specifications<a class="headerlink" href="#solution-3-c-fortran-type-specifications" title="Permalink to this headline">¶</a></h4>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">g2</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="o">::</span><span class="kt">Float64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">10</span><span class="w"></span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">/</span><span class="mi">2</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="nd">@show</span><span class="w"> </span><span class="n">g2</span><span class="p">()</span><span class="w"></span>
<span class="nd">@code_llvm</span><span class="w"> </span><span class="n">debuginfo</span><span class="o">=</span><span class="ss">:none</span><span class="w"> </span><span class="n">g2</span><span class="p">()</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>g2() = 0.0009765625

define double @julia_g2_22844() {
top:
  ret double 0x3F50000000000000
}
</pre></div>
</div>
</div>
<div class="section" id="solution-4-function-barriers">
<h4>Solution 4: Function barriers<a class="headerlink" href="#solution-4-function-barriers" title="Permalink to this headline">¶</a></h4>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Union</span><span class="p">{</span><span class="kt">Int64</span><span class="p">,</span><span class="w"> </span><span class="kt">Float64</span><span class="p">,</span><span class="w"> </span><span class="kt">String</span><span class="p">}[</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">3.2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="k">function</span><span class="w"> </span><span class="n">calc_square</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">eachindex</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"></span>
<span class="w">        </span><span class="n">val</span><span class="o">^</span><span class="mi">2</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="nd">@code_warntype</span><span class="w"> </span><span class="n">calc_square</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Variables
  #self#[36m::Core.Compiler.Const(calc_square, false)[39m
  x[36m::Array{Union{Float64, Int64, String},1}[39m
  @_3[33m[1m::Union{Nothing, Tuple{Int64,Int64}}[22m[39m
  i[36m::Int64[39m
  val[91m[1m::Union{Float64, Int64, String}[22m[39m

Body[36m::Nothing[39m
[90m1 ─[39m %1  = Main.eachindex(x)[36m::Base.OneTo{Int64}[39m
[90m│  [39m       (@_3 = Base.iterate(%1))
[90m│  [39m %3  = (@_3 === nothing)[36m::Bool[39m
[90m│  [39m %4  = Base.not_int(%3)[36m::Bool[39m
[90m└──[39m       goto #4 if not %4
[90m2 ┄[39m %6  = @_3::Tuple{Int64,Int64}[36m::Tuple{Int64,Int64}[39m
[90m│  [39m       (i = Core.getfield(%6, 1))
[90m│  [39m %8  = Core.getfield(%6, 2)[36m::Int64[39m
[90m│  [39m       (val = Base.getindex(x, i))
[90m│  [39m %10 = val[91m[1m::Union{Float64, Int64, String}[22m[39m
[90m│  [39m %11 = Core.apply_type(Base.Val, 2)[36m::Core.Compiler.Const(Val{2}, false)[39m
[90m│  [39m %12 = (%11)()[36m::Core.Compiler.Const(Val{2}(), false)[39m
[90m│  [39m       Base.literal_pow(Main.:^, %10, %12)
[90m│  [39m       (@_3 = Base.iterate(%1, %8))
[90m│  [39m %15 = (@_3 === nothing)[36m::Bool[39m
[90m│  [39m %16 = Base.not_int(%15)[36m::Bool[39m
[90m└──[39m       goto #4 if not %16
[90m3 ─[39m       goto #2
[90m4 ┄[39m       return
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">calc_square_outer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">eachindex</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">calc_square_inner</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"></span>
<span class="w">  </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="n">calc_square_inner</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">^</span><span class="mi">2</span><span class="w"></span>
<span class="nd">@code_warntype</span><span class="w"> </span><span class="n">calc_square_inner</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Variables
  #self#[36m::Core.Compiler.Const(calc_square_inner, false)[39m
  x[36m::Int64[39m

Body[36m::Int64[39m
[90m1 ─[39m %1 = Core.apply_type(Base.Val, 2)[36m::Core.Compiler.Const(Val{2}, false)[39m
[90m│  [39m %2 = (%1)()[36m::Core.Compiler.Const(Val{2}(), false)[39m
[90m│  [39m %3 = Base.literal_pow(Main.:^, x, %2)[36m::Int64[39m
[90m└──[39m      return %3
</pre></div>
</div>
</div>
</div>
<div class="section" id="gotcha-3-views-and-copies">
<h3>Gotcha 3: Views and copies<a class="headerlink" href="#gotcha-3-views-and-copies" title="Permalink to this headline">¶</a></h3>
<p>Suppose: for a given 3x3 matrix M and vector V want to calculate the dot product of the first column of M and v:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">BenchmarkTools</span><span class="p">,</span><span class="w"> </span><span class="n">LinearAlgebra</span><span class="w"></span>
<span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>3-element Array{Float64,1}:
 0.7360207102515517
 0.5351549465523613
 0.8427666727425576
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">g</span><span class="p">(</span><span class="o">$</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">$</span><span class="n">M</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MethodError: no method matching g(::Array{Float64,1}, ::Array{Float64,2})



Stacktrace:

 [1] ##core#272(::Array{Float64,1}, ::Array{Float64,2}) at /Users/minerva/.julia/packages/BenchmarkTools/eCEpo/src/execution.jl:371

 [2] ##sample#273(::BenchmarkTools.Parameters) at /Users/minerva/.julia/packages/BenchmarkTools/eCEpo/src/execution.jl:377

 [3] _run(::BenchmarkTools.Benchmark{Symbol(&quot;##benchmark#271&quot;)}, ::BenchmarkTools.Parameters; verbose::Bool, pad::String, kwargs::Base.Iterators.Pairs{Symbol,Integer,NTuple{4,Symbol},NamedTuple{(:samples, :evals, :gctrial, :gcsample),Tuple{Int64,Int64,Bool,Bool}}}) at /Users/minerva/.julia/packages/BenchmarkTools/eCEpo/src/execution.jl:405

 [4] (::Base.var&quot;#inner#2&quot;{Base.Iterators.Pairs{Symbol,Integer,NTuple{5,Symbol},NamedTuple{(:verbose, :samples, :evals, :gctrial, :gcsample),Tuple{Bool,Int64,Int64,Bool,Bool}}},typeof(BenchmarkTools._run),Tuple{BenchmarkTools.Benchmark{Symbol(&quot;##benchmark#271&quot;)},BenchmarkTools.Parameters}})() at ./essentials.jl:715

 [5] #invokelatest#1 at ./essentials.jl:716 [inlined]

 [6] #run_result#37 at /Users/minerva/.julia/packages/BenchmarkTools/eCEpo/src/execution.jl:32 [inlined]

 [7] run(::BenchmarkTools.Benchmark{Symbol(&quot;##benchmark#271&quot;)}, ::BenchmarkTools.Parameters; progressid::Nothing, nleaves::Float64, ndone::Float64, kwargs::Base.Iterators.Pairs{Symbol,Integer,NTuple{5,Symbol},NamedTuple{(:verbose, :samples, :evals, :gctrial, :gcsample),Tuple{Bool,Int64,Int64,Bool,Bool}}}) at /Users/minerva/.julia/packages/BenchmarkTools/eCEpo/src/execution.jl:94

 [8] #warmup#45 at /Users/minerva/.julia/packages/BenchmarkTools/eCEpo/src/execution.jl:141 [inlined]

 [9] warmup(::BenchmarkTools.Benchmark{Symbol(&quot;##benchmark#271&quot;)}) at /Users/minerva/.julia/packages/BenchmarkTools/eCEpo/src/execution.jl:141

 [10] top-level scope at /Users/minerva/.julia/packages/BenchmarkTools/eCEpo/src/execution.jl:481

 [11] top-level scope at In[61]:2
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">view</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">g</span><span class="p">(</span><span class="o">$</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">$</span><span class="n">M</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  26.839 ns (1 allocation: 64 bytes)
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@views</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">g</span><span class="p">(</span><span class="o">$</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">$</span><span class="n">M</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  26.574 ns (1 allocation: 64 bytes)
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="o">?</span><span class="nd">@views</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@views</span> <span class="n">expression</span>
</pre></div>
</div>
<p>Convert every array-slicing operation in the given expression (which may be a <code class="docutils literal notranslate"><span class="pre">begin</span></code>/<code class="docutils literal notranslate"><span class="pre">end</span></code> block, loop, function, etc.) to return a view. Scalar indices, non-array types, and explicit <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">getindex</span></code></span> calls (as opposed to <code class="docutils literal notranslate"><span class="pre">array[...]</span></code>) are unaffected.</p>
<p>!!! note
The <code class="docutils literal notranslate"><span class="pre">&#64;views</span></code> macro only affects <code class="docutils literal notranslate"><span class="pre">array[...]</span></code> expressions that appear explicitly in the given <code class="docutils literal notranslate"><span class="pre">expression</span></code>, not array slicing that occurs in functions called by that code.</p>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="highlight-jldoctest notranslate"><div class="highlight"><pre><span></span>julia&gt; A = zeros(3, 3);

julia&gt; @views for row in 1:3
           b = A[row, :]
           b[:] .= row
       end

julia&gt; A
3×3 Array{Float64,2}:
 1.0  1.0  1.0
 2.0  2.0  2.0
 3.0  3.0  3.0
</pre></div>
</div>
<div class="section" id="gotcha-4-temporary-allocations-and-vectorized-code">
<h3>Gotcha 4: Temporary allocations and vectorized code<a class="headerlink" href="#gotcha-4-temporary-allocations-and-vectorized-code" title="Permalink to this headline">¶</a></h3>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">BenchmarkTools</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">f</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">5</span><span class="p">;</span><span class="mi">6</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">100_000</span><span class="w"></span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="nd">@btime</span><span class="w"> </span><span class="n">f</span><span class="p">()</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  7.214 ms (200001 allocations: 21.36 MiB)





3-element Array{Int64,1}:
 -3665183052406099839
   120828811679052421
 -3544354240727047418
</pre></div>
</div>
<div class="section" id="solution-more-dots-and-explicit-code">
<h4>Solution: More dots and explicit code<a class="headerlink" href="#solution-more-dots-and-explicit-code" title="Permalink to this headline">¶</a></h4>
<p>Read <a class="reference external" href="https://julialang.org/blog/2017/01/moredots/">this blog post</a>:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">f</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">5</span><span class="p">;</span><span class="mi">6</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">100_000</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">3</span><span class="w"></span>
<span class="w">            </span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="nd">@btime</span><span class="w"> </span><span class="n">f</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  100.291 μs (1 allocation: 112 bytes)
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">f</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">5</span><span class="p">;</span><span class="mi">6</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">100_000</span><span class="w"></span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="nd">@btime</span><span class="w"> </span><span class="n">f</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  3.799 ms (100001 allocations: 10.68 MiB)
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">f</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">5</span><span class="p">;</span><span class="mi">6</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">100_000</span><span class="w"></span>
<span class="w">        </span><span class="nd">@.</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">f</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  158.971 μs (1 allocation: 112 bytes)
</pre></div>
</div>
<p>Reference for bounding in <a class="reference external" href="https://docs.julialang.org/en/v1/devdocs/boundscheck/index.html">official documentation</a>:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Extra performance with @inbounds</span><span class="w"></span>
<span class="k">function</span><span class="w"> </span><span class="n">f</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">5</span><span class="p">;</span><span class="mi">6</span><span class="p">]</span><span class="w"></span>
<span class="w">   </span><span class="nd">@inbounds</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">100_000</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">3</span><span class="w"></span>
<span class="w">            </span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="nd">@btime</span><span class="w"> </span><span class="n">f</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  75.224 μs (1 allocation: 112 bytes)
</pre></div>
</div>
</div>
</div>
<div class="section" id="gotcha-5-abstract-fields">
<h3>Gotcha 5: Abstract fields<a class="headerlink" href="#gotcha-5-abstract-fields" title="Permalink to this headline">¶</a></h3>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="kt">MyType</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="o">::</span><span class="kt">AbstractFloat</span><span class="w"></span>
<span class="w">    </span><span class="n">y</span><span class="o">::</span><span class="kt">AbstractString</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="o">::</span><span class="kt">MyType</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="o">.</span><span class="n">x</span><span class="o">^</span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>f (generic function with 2 methods)
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyType</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test&quot;</span><span class="p">)</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="o">$</span><span class="n">a</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  61.015 ns (3 allocations: 48 bytes)
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="kt">MyTypeConcrete</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="o">::</span><span class="kt">Float64</span><span class="w"></span>
<span class="w">    </span><span class="n">y</span><span class="o">::</span><span class="kt">String</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="o">::</span><span class="kt">MyTypeConcrete</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="o">^</span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>f (generic function with 3 methods)
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyTypeConcrete</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test&quot;</span><span class="p">)</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="o">$</span><span class="n">b</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  2.038 ns (0 allocations: 0 bytes)
</pre></div>
</div>
<p>Notice the speed increase when using concrete types. But what if you require the use of Abstract generics? Well, use parameters:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="kt">MyTypeParametric</span><span class="p">{</span><span class="kt">A</span><span class="o">&lt;:</span><span class="kt">AbstractFloat</span><span class="p">,</span><span class="w"> </span><span class="kt">B</span><span class="o">&lt;:</span><span class="kt">AbstractString</span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="o">::</span><span class="kt">A</span><span class="w"></span>
<span class="w">    </span><span class="n">y</span><span class="o">::</span><span class="kt">B</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="n">f</span><span class="p">(</span><span class="n">c</span><span class="o">::</span><span class="kt">MyTypeParametric</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">^</span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="w"></span>

<span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyTypeParametric</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test&quot;</span><span class="p">)</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="o">$</span><span class="n">c</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  2.035 ns (0 allocations: 0 bytes)
</pre></div>
</div>
</div>
<div class="section" id="gotcha-6-writing-to-global-scope">
<h3>Gotcha 6: Writing to global scope<a class="headerlink" href="#gotcha-6-writing-to-global-scope" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="https://github.com/JuliaLang/julia/issues/28789">this github issue</a>. Solution: use code block wrapping or functions.</p>
</div>
<div class="section" id="gotcha-7-column-major-order">
<h3>Gotcha 7: Column major order<a class="headerlink" href="#gotcha-7-column-major-order" title="Permalink to this headline">¶</a></h3>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span><span class="n">fcol!</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">size</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">size</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">M</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="nb">nothing</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span><span class="n">frow!</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">size</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">size</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">M</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="nb">nothing</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>frow! (generic function with 1 method)
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@btime</span><span class="w"> </span><span class="n">fcol!</span><span class="p">(</span><span class="o">$</span><span class="n">M</span><span class="p">)</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">frow!</span><span class="p">(</span><span class="o">$</span><span class="n">M</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  494.288 μs (0 allocations: 0 bytes)
  1.083 ms (0 allocations: 0 bytes)
</pre></div>
</div>
<div class="section" id="nb-put-the-fastest-varying-index-first">
<h4><strong>NB</strong>: put the fastest varying index first!<a class="headerlink" href="#nb-put-the-fastest-varying-index-first" title="Permalink to this headline">¶</a></h4>
</div>
</div>
<div class="section" id="gotcha-8-lazy-operations">
<h3>Gotcha 8: Lazy operations<a class="headerlink" href="#gotcha-8-lazy-operations" title="Permalink to this headline">¶</a></h3>
<p>Say want to calculate
$<span class="math notranslate nohighlight">\(X = M + (M^\prime + 2 I)\)</span>$</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">LinearAlgebra</span><span class="w"></span>
<span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span><span class="w"></span>
<span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">M</span><span class="o">&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">I</span><span class="p">)</span><span class="w"> </span><span class="c"># nb: I is implemented by Linear Algebra</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2×2 Array{Int64,2}:
 4   5
 5  10
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="o">?</span><span class="n">I</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>search: [0m[1mI[22m [0m[1mI[22mO [0m[1mI[22mn [0m[1mi[22mf [0m[1mI[22mnt [0m[1mi[22mn [0m[1mi[22mm [0m[1mI[22mnf [0m[1mi[22msa [0m[1mI[22mnt8 [0m[1mi[22mnv [0m[1mI[22mnt64 [0m[1mI[22mnt32 [0m[1mI[22mnt16 [0m[1mi[22mmag [0m[1mI[22mnf64 [0m[1mI[22mnf32
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span>
</pre></div>
</div>
<p>An object of type <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">UniformScaling</span></code></span>, representing an identity matrix of any size.</p>
</div>
</div>
<div class="section" id="id1">
<h2>Examples<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="highlight-jldoctest notranslate"><div class="highlight"><pre><span></span>julia&gt; fill(1, (5,6)) * I == fill(1, (5,6))
true

julia&gt; [1 2im 3; 1im 2 3] * I
2×3 Array{Complex{Int64},2}:
 1+0im  0+2im  3+0im
 0+1im  2+0im  3+0im
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">I</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">one</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>true
</pre></div>
</div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># assume we used more explicity implementation</span><span class="w"></span>
<span class="k">function</span><span class="w"> </span><span class="n">calc</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="o">&#39;</span><span class="w"> </span>
<span class="w">    </span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">    </span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">    </span><span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">X</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c"># correctness check</span><span class="w"></span>
<span class="n">calc</span><span class="p">([</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">M</span><span class="o">&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>false
</pre></div>
</div>
<p>The issue here is that <code class="docutils literal notranslate"><span class="pre">M'</span></code> is a <em>lazy adjoint</em> of <code class="docutils literal notranslate"><span class="pre">M</span></code>; i.e. a different view on the same memory. When we do <code class="docutils literal notranslate"><span class="pre">X[1,1]</span> <span class="pre">+=</span> <span class="pre">1</span></code> we actually change M implicity, hence obtaining the wrong resupt. If we want the explicit implementation, we’ll have to use a copy:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">calc_corrected</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">copy</span><span class="p">(</span><span class="n">M</span><span class="o">&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">X</span><span class="p">[</span><span class="n">diagind</span><span class="p">(</span><span class="n">X</span><span class="p">)]</span><span class="w"> </span><span class="o">.+=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">    </span><span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">X</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="n">calc_corrected</span><span class="p">([</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">M</span><span class="o">&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>true
</pre></div>
</div>
<p>Note that this is not an issue; on the contrary, the lazy views (and allocation free identity matrix provided through <code class="docutils literal notranslate"><span class="pre">I</span></code>) is preceisely the reason why the straight forward solution is faster! Observe:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">calc_straightforward</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="o">&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="nd">@btime</span><span class="w"> </span><span class="n">calc</span><span class="p">(</span><span class="o">$</span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">]);</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">calc_corrected</span><span class="p">(</span><span class="o">$</span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">]);</span><span class="w"></span>
<span class="nd">@btime</span><span class="w"> </span><span class="n">calc_straightforward</span><span class="p">(</span><span class="o">$</span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">]);</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  58.382 ns (2 allocations: 128 bytes)
  196.369 ns (5 allocations: 400 bytes)
  102.890 ns (3 allocations: 240 bytes)
</pre></div>
</div>
<div class="section" id="extra-generators-and-comprehension">
<h3>Extra: Generators and comprehension.<a class="headerlink" href="#extra-generators-and-comprehension" title="Permalink to this headline">¶</a></h3>
<p>For generators, see <a class="reference external" href="https://docs.julialang.org/en/v1/manual/arrays/#Generator-Expressions-1">here</a>.</p>
<p>For comprehension, see <a class="reference external" href="https://docs.julialang.org/en/v1/manual/arrays/#Comprehensions-1">here</a>.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./julia"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Julia Notes</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="advent-notes/README.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Advent of Code notes</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Fergus Baker<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>